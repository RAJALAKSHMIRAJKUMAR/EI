-- version:0.8 -- sdate:09/06/2014 -- edate:09/06/2014 -- issue:566 --desc:IMPLEMENTING COMMIT AND ROLLBACK --done by:BHAVANI.R
-- version:0.7 -- sdate:26/04/2014 -- edate:26/04/2014 -- issue:765 --desc:REMOVED ADMIN,SUPER ADMIN ND USER FOLDER --done by:RL
-- version:0.6 -- sdate:22/04/2014 -- edate:22/04/2014 -- issue:765 --desc:UPDATED TIMESTAMP --done by:SASIKALA
-- version:0.5 -- sdate:10/04/2014 -- edate:10/04/2014 -- issue:765 --desc:changing dd ss id as dd folder id --done by:RL
-- version:0.4 -- sdate:19/03/2014 -- edate:19/03/2014 -- issue:765 --desc:dynamically get source nd destination schema --doneby:SAFI
-- version:0.3 -- sdate:17/03/2014 -- edate:17/03/2014 -- issue:765 --desc:droped temp table --doneby:RL
--    version:0.2 --    sdate:25/02/2014 --    edate:25/02/2014 --    issue:750 --    desc:getting userstamp n time stamp from db & userstamp changed as uld_id --    doneby:RL
--    version:0.1 --    sdate:20/02/2014 --    edate:21/02/2014 --    issue:750 --    desc:Implementing audit table insert --    doneby:RL
DROP PROCEDURE IF EXISTS UPDATE_TEMP_CONFIG_SCDB_FORMAT;
CREATE PROCEDURE UPDATE_TEMP_CONFIG_SCDB_FORMAT(IN SOURCESCHEMA  VARCHAR(40),IN DESTINATIONSCHEMA  VARCHAR(40))
BEGIN
BEGIN 
ROLLBACK;
END;
START TRANSACTION;
      SET FOREIGN_KEY_CHECKS=0;
     SET @DROP_TEMP_CONFIG_SCDB_FORMAT=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT'));
     PREPARE DROP_TEMP_CONFIG_SCDB_FORMAT_STMT FROM @DROP_TEMP_CONFIG_SCDB_FORMAT;
     EXECUTE DROP_TEMP_CONFIG_SCDB_FORMAT_STMT;
     SET @CREATE_TEMP_CONFIG_SCDB_FORMAT=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT LIKE ',SOURCESCHEMA,'.CONFIG_SCDB_FORMAT'));
     PREPARE CREATE_TEMP_CONFIG_SCDB_FORMAT_STMT FROM @CREATE_TEMP_CONFIG_SCDB_FORMAT;
     EXECUTE CREATE_TEMP_CONFIG_SCDB_FORMAT_STMT;
	 SET @INSERT_TEMP_CONFIG_SCDB_FORMAT=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT  SELECT * FROM ',SOURCESCHEMA,'.CONFIG_SCDB_FORMAT'));
	 PREPARE INSERT_TEMP_CONFIG_SCDB_FORMAT_STMT FROM @INSERT_TEMP_CONFIG_SCDB_FORMAT;
     EXECUTE INSERT_TEMP_CONFIG_SCDB_FORMAT_STMT;
	 SET @DELETE_ADMIN = (SELECT CONCAT('DELETE FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_TYPE="ADMIN"'));
	 PREPARE DELETE_ADMIN_STMT FROM @DELETE_ADMIN;
	 EXECUTE DELETE_ADMIN_STMT;
	 SET @DELETE_USER = (SELECT CONCAT('DELETE FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_TYPE="USER"'));
	 PREPARE DELETE_USER_STMT FROM @DELETE_USER;
	 EXECUTE DELETE_USER_STMT;
	 SET @DELETE_SUPERADMIN = (SELECT CONCAT('DELETE FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_TYPE="SUPER ADMIN"'));
	 PREPARE DELETE_SUPERADMIN_STMT FROM @DELETE_SUPERADMIN;
	 EXECUTE DELETE_SUPERADMIN_STMT;
	 SET @UPDATE_ACCESSRIGHTS_ROLES=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'ACCESSRIGHTS ROLES'",' WHERE CF_TYPE = ',"'ACCESSRIGHTS_ROLES'"));
	 PREPARE UPDATE_ACCESSRIGHTS_ROLES_STMT FROM @UPDATE_ACCESSRIGHTS_ROLES;
     EXECUTE UPDATE_ACCESSRIGHTS_ROLES_STMT; 
	 SET @UPDATE_CAL_NAME=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CALENDER NAME'",' WHERE CF_TYPE = ',"'CAL_NAME'"));
	 PREPARE UPDATE_CAL_NAME_STMT FROM @UPDATE_CAL_NAME;
     EXECUTE UPDATE_CAL_NAME_STMT;	 
	 SET @CC_ADDR_OS=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC ADDRESS OS'",' WHERE CF_TYPE = ',"'CC_ADDR_OS'"));
	 PREPARE UPDATE_CC_ADDR_OS_STMT FROM @CC_ADDR_OS;
     EXECUTE UPDATE_CC_ADDR_OS_STMT;	 
	 SET @CC_ADDR_T1=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC ADDRESS T1'",' WHERE CF_TYPE = ',"'CC_ADDR_T1'"));
	 PREPARE UPDATE_CC_ADDR_T1_STMT FROM @CC_ADDR_T1;
     EXECUTE UPDATE_CC_ADDR_T1_STMT;
	 SET @CC_ADDR_T2=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC ADDRESS T2'",' WHERE CF_TYPE = ',"'CC_ADDR_T2'"));
	 PREPARE UPDATE_CC_ADDR_T2_STMT FROM @CC_ADDR_T2;
     EXECUTE UPDATE_CC_ADDR_T2_STMT; 	
	 SET @CC_AIR_FIXED=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC AIRCON FIXED'",' WHERE CF_TYPE = ',"'CC_AIR_FIXED'"));
	 PREPARE UPDATE_CC_AIR_FIXED_STMT FROM @CC_AIR_FIXED;
     EXECUTE UPDATE_CC_AIR_FIXED_STMT;	 
	 SET @CC_AIR_QUARTERLY=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC AIRCON QUARTERLY'",' WHERE CF_TYPE = ',"'CC_AIR_QUARTERLY'"));
	 PREPARE UPDATE_CC_AIR_QUARTERLY_STMT FROM @CC_AIR_QUARTERLY;
     EXECUTE UPDATE_CC_AIR_QUARTERLY_STMT;
	 SET @CC_CONTR_TEMPL_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC CONTRACT TEMPLATE ID'",' WHERE CF_TYPE = ',"'CC_CONTR_TEMPL_ID'"));
	 PREPARE UPDATE_CC_CONTR_TEMPL_ID_STMT FROM @CC_CONTR_TEMPL_ID;
     EXECUTE UPDATE_CC_CONTR_TEMPL_ID_STMT;
	 SET @CC_INV_TEMPL_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC INVOICE TEMPLATE ID'",' WHERE CF_TYPE = ',"'CC_INV_TEMPL_ID'"));
	 PREPARE UPDATE_CC_INV_TEMPL_ID_STMT FROM @CC_INV_TEMPL_ID;
     EXECUTE UPDATE_CC_INV_TEMPL_ID_STMT;
	 SET @CC_NATIONALITY=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'NATIONALITY'",' WHERE CF_TYPE = ',"'CC_NATIONALITY'"));
	 PREPARE UPDATE_CC_NATIONALITY_STMT FROM @CC_NATIONALITY;
     EXECUTE UPDATE_CC_NATIONALITY_STMT;
	 SET @CC_NOTICEPERIOD_TEXT=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC NOTICE PERIOD TEXT'",' WHERE CF_TYPE = ',"'CC_NOTICEPERIOD_TEXT'"));
	 PREPARE UPDATE_CC_NOTICEPERIOD_TEXT_STMT FROM @CC_NOTICEPERIOD_TEXT;
     EXECUTE UPDATE_CC_NOTICEPERIOD_TEXT_STMT;
	 SET @CC_OPTION=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC OPTION'",' WHERE CF_TYPE = ',"'CC_OPTION'"));
	 PREPARE UPDATE_CC_OPTION_STMT FROM @CC_OPTION;
     EXECUTE UPDATE_CC_OPTION_STMT;
	 SET @CC_PR_FEE=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC PROCESSING FEE'",' WHERE CF_TYPE = ',"'CC_PR_FEE'"));
	 PREPARE UPDATE_CC_PR_FEE_STMT FROM @CC_PR_FEE;
     EXECUTE UPDATE_CC_PR_FEE_STMT;
	 SET @CC_PRO_RENT=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC RENT PRORATED'",' WHERE CF_TYPE = ',"'CC_PRO_RENT'"));
	 PREPARE UPDATE_CC_PRO_RENT_STMT FROM @CC_PRO_RENT;
     EXECUTE UPDATE_CC_PRO_RENT_STMT;
	 SET @CC_PRORATE_LINE_NO=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC PRORATE LINE NO'",' WHERE CF_TYPE = ',"'CC_PRORATE_LINE_NO'"));
	 PREPARE UPDATE_CC_PRORATE_LINE_NO_STMT FROM @CC_PRORATE_LINE_NO;
     EXECUTE UPDATE_CC_PRORATE_LINE_NO_STMT;
	 SET @CC_PRORATED_LBL=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CUSTOMER PRORATED STATEMENT'",' WHERE CF_TYPE = ',"'CC_PRORATED_LBL'"));
	 PREPARE UPDATE_CC_PRORATED_LBL_STMT FROM @CC_PRORATED_LBL;
     EXECUTE UPDATE_CC_PRORATED_LBL_STMT;
	 SET @DEPOSIT_CALC_SS_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'DEPOSIT CALCULATION FOLDER ID'",' WHERE CF_TYPE = ',"'DEPOSIT_CALC_SS_ID'"));
	 PREPARE UPDATE_DEPOSIT_CALC_SS_ID_STMT FROM @DEPOSIT_CALC_SS_ID;
     EXECUTE UPDATE_DEPOSIT_CALC_SS_ID_STMT;
	 SET @OCBC_CSV_FOLDER_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'OCBC CSV FOLDER ID'",' WHERE CF_TYPE = ',"'OCBC_CSV_FOLDER_ID'"));
	 PREPARE UPDATE_OCBC_CSV_FOLDER_ID_STMT FROM @OCBC_CSV_FOLDER_ID;
     EXECUTE UPDATE_OCBC_CSV_FOLDER_ID_STMT;
	 SET @RENTAL=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'PAYMENT'",' WHERE CF_TYPE = ',"'RENTAL'"));
	 PREPARE UPDATE_RENTAL_STMT FROM @RENTAL;
     EXECUTE UPDATE_RENTAL_STMT;
	 SET @TRIGGER_NAME=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'TRIGGER NAME'",' WHERE CF_TYPE = ',"'TRIGGER_NAME'"));
	 PREPARE UPDATE_TRIGGER_NAME_STMT FROM @TRIGGER_NAME;
     EXECUTE UPDATE_TRIGGER_NAME_STMT;
	 SET @CC_PR_FEE=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_TYPE = ',"'CC PROCESSING FEE'",' WHERE CF_TYPE = ',"'CC_PR_FEE'"));
	 PREPARE UPDATE_CC_PR_FEE_STMT FROM @CC_PR_FEE;
     EXECUTE UPDATE_CC_PR_FEE_STMT;
	 SET @BAHAMAS=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'BAHAMAS, THE'",' WHERE CF_DATA = ',"'BAHAMAS'"));
	 PREPARE UPDATE_BAHAMAS_STMT FROM @BAHAMAS;
     EXECUTE UPDATE_BAHAMAS_STMT;
	 SET @OCBC_CSV_RECORDS=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'CSV UPDATION'",' WHERE CF_DATA = ',"'OCBC CSV RECORDS'"));
	 PREPARE UPDATE_OCBC_CSV_RECORDS_STMT FROM @OCBC_CSV_RECORDS;
     EXECUTE UPDATE_OCBC_CSV_RECORDS_STMT;	 
	 SET @DEPOSIT_CALCULATION_SS_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'0Bz8XDWwyuSghZzZITW9pZkVpN00'",' WHERE CF_TYPE = ',"'DEPOSIT CALCULATION FOLDER ID'"));
	 PREPARE UPDATE_DEPOSIT_CALCULATION_SS_ID_STMT FROM @DEPOSIT_CALCULATION_SS_ID;
     EXECUTE UPDATE_DEPOSIT_CALCULATION_SS_ID_STMT;	 
	 SET @HOUSE_KEEPING=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'HOUSEKEEPING'",' WHERE CF_DATA = ',"'HOUSE KEEPING'"));
	 PREPARE UPDATE_HOUSE_KEEPING_STMT FROM @HOUSE_KEEPING;
     EXECUTE UPDATE_HOUSE_KEEPING_STMT;	 
	 SET @HOUSE_KEEPING_PAYMENT=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'HOUSEKEEPING PAYMENT'",' WHERE CF_DATA = ',"'HOUSE KEEPING PAYMENT'"));
	 PREPARE UPDATE_HOUSE_KEEPING_PAYMENT_STMT FROM @HOUSE_KEEPING_PAYMENT;
     EXECUTE UPDATE_HOUSE_KEEPING_PAYMENT_STMT;	 
	 SET @STAR_HUB=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'STARHUB'",' WHERE CF_DATA = ',"'STAR HUB'"));
	 PREPARE UPDATE_STAR_HUB_STMT FROM @STAR_HUB;
     EXECUTE UPDATE_STAR_HUB_STMT;	 
	 SET @STAR_HUB=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'STARHUB'",' WHERE CF_DATA = ',"'STAR HUB'"));
	 PREPARE UPDATE_STAR_HUB_STMT FROM @STAR_HUB;
     EXECUTE UPDATE_STAR_HUB_STMT;	 
	 SET @CARPARK=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'CARPARK'",' WHERE CF_DATA = ',"'CAR PARK'"));
	 PREPARE UPDATE_CARPARK_STMT FROM @CARPARK;
     EXECUTE UPDATE_CARPARK_STMT;	 
	 SET @OCBC_CSV_FOLDER_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'0B0KangOyYg_pME44T0p3OTgwRW8'",' WHERE CF_TYPE = ',"'OCBC CSV FOLDER ID'"));
	 PREPARE UPDATE_OCBC_CSV_FOLDER_ID_STMT FROM @OCBC_CSV_FOLDER_ID;
     EXECUTE UPDATE_OCBC_CSV_FOLDER_ID_STMT;	 
	 SET @PAYMENT=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'PAYMENT'",' WHERE CF_DATA = ',"'RENTAL AMOUNT'"));
	 PREPARE UPDATE_PAYMENT_STMT FROM @PAYMENT;
     EXECUTE UPDATE_PAYMENT_STMT;	 
	 SET @EI=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'EI_SQL'",' WHERE CF_DATA = ',"'EI'"));
	 PREPARE UPDATE_EI_STMT FROM @EI;
     EXECUTE UPDATE_EI_STMT;	 
	 SET @T1=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'THE SAIL@MARINA BAY, MARINA BAY TOWER 2,MARINA BOULEVARD,SINGAPORE -018987'",' WHERE CF_TYPE = ',"'CC ADDRESS T1'"));
	 PREPARE UPDATE_T1_STMT FROM @T1;
     EXECUTE UPDATE_T1_STMT;	 
	 SET @T2=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'THE SAIL@MARINA BAY, CENTRAL PARK TOWER 6,MARINA BOULEVARD,SINGAPORE -018985'",' WHERE CF_TYPE = ',"'CC ADDRESS T2'"));
	 PREPARE UPDATE_T2_STMT FROM @T2;
     EXECUTE UPDATE_T2_STMT;	 
	 SET @TEMPLATE_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'1OScbLPz0naY82-jG4bvVkRuQdIL8InLKAH9Tte6TPmM'",' WHERE CF_TYPE = ',"'CC CONTRACT TEMPLATE ID'"));
	 PREPARE UPDATE_TEMPLATE_ID_STMT FROM @TEMPLATE_ID;
     EXECUTE UPDATE_TEMPLATE_ID_STMT;	 
	 SET @INVOICETEMPLATE_ID=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'1VOtIFrvgdqATsOszmk1CcqWMEvSgHIuchfmoe7A2qUM'",' WHERE CF_TYPE = ',"'CC INVOICE TEMPLATE ID'"));
	 PREPARE UPDATE_INVOICETEMPLATE_ID_STMT FROM @INVOICETEMPLATE_ID;
     EXECUTE UPDATE_INVOICETEMPLATE_ID_STMT;	 
	 SET @PRORATE_LINE_NO=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'19'",' WHERE CF_TYPE = ',"'CC PRORATE LINE NO'"));
	 PREPARE UPDATE_PRORATE_LINE_NO_STMT FROM @PRORATE_LINE_NO;
     EXECUTE UPDATE_PRORATE_LINE_NO_STMT;	 
	 SET @INVOICE_DATE=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET CF_DATA = ',"'2012-08-09'",' WHERE CF_TYPE = ',"'INVOICE DATE'"));
	 PREPARE UPDATE_INVOICE_DATE_STMT FROM @INVOICE_DATE;
     EXECUTE UPDATE_INVOICE_DATE_STMT;
      SET FOREIGN_KEY_CHECKS=1;
      SET @UPDATETIMESTAMP=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT SET TIMESTAMP=(SELECT CONVERT_TZ(TIMESTAMP, "+08:00","+0:00"))'));
PREPARE UPDATETIMESTAMPSTMT FROM @UPDATETIMESTAMP;
EXECUTE UPDATETIMESTAMPSTMT;
COMMIT;
END;	
CALL UPDATE_TEMP_CONFIG_SCDB_FORMAT('source_04062014','dest_04062014');