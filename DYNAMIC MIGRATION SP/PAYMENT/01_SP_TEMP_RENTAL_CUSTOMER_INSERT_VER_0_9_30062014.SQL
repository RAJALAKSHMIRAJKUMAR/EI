--version:0.9 --sdate:30/06/2014 --edate:30/06/2014 --desc:changed TEMP_RENTAL_CUSTOMER_INSERT as sp_TEMP_RENTAL_CUSTOMER_INSERT (sp name) done by :rl
-- version:0.8 -- sdate:09/06/2014 -- edate:09/06/2014 -- issue:566 --COMMENT NO: 12--desc:IMPLEMENTED ROLL BACK AND COMMIT --doneby:DHIVYA
-- version:0.7 -- sdate:19/03/2014 -- edate:22/03/2014 -- issue:810 --COMMENT NO: 8--desc:CHANGED TIMEZONE --doneby:DHIVYA
-- version:0.6 -- sdate:19/03/2014 -- edate:26/03/2014 -- issue:765 --COMMENT NO: 8--desc:UPDATED SP DYNAMICALLY --doneby:SAFI
-- version:0.5 -- sdate:17/03/2014 -- edate:17/03/2014 -- issue:765 --desc:droped temp table --doneby:RL
--version:0.4 --sdate:26/02/2014 --edate:26/02/2014 --issue:750 --desc:userstamp changed as uld_id --done by:RL
--version:0.3 --sdate:20/02/2014 --edate:20/02/2014 --issue:594 --comment:104 --done by:DHIVYA
--version:0.2 --sdate:24/01/2014 --edate:30/01/2014 --issue:594 --desc:changed migration.rental_scdb_format as rental_scdb_format n update rec version --doneby:RL

DROP PROCEDURE IF EXISTS SP_TEMP_RENTAL_CUSTOMER_INSERT;
CREATE PROCEDURE SP_TEMP_RENTAL_CUSTOMER_INSERT(IN SOURCESCHEMA  VARCHAR(40),IN DESTINATIONSCHEMA  VARCHAR(40))
BEGIN
DECLARE STARTTIME TIME;
DECLARE ENDTIME TIME;
DECLARE DURATION TIME;
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK;
END;
START TRANSACTION;
SET STARTTIME=(SELECT CURTIME());
    SET FOREIGN_KEY_CHECKS=0; 
    SET @DROP_TEMP_RENTAL_CUSTOMER=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.TEMP_RENTAL_CUSTOMER'));
    PREPARE DROP_TEMP_RENTAL_CUSTOMER_STMT FROM @DROP_TEMP_RENTAL_CUSTOMER;
    EXECUTE DROP_TEMP_RENTAL_CUSTOMER_STMT;    
	SET @CREATE_TEMP_RENTAL_CUSTOMER=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.TEMP_RENTAL_CUSTOMER(ID INTEGER NOT NULL AUTO_INCREMENT,CUST_ID INTEGER,CUSTOMER_NAME CHAR(100),
	UNITNO INTEGER,PRIMARY KEY(ID))'));
	PREPARE CREATE_TEMP_RENTAL_CUSTOMER_STMT FROM @CREATE_TEMP_RENTAL_CUSTOMER;
    EXECUTE CREATE_TEMP_RENTAL_CUSTOMER_STMT;
	SET @INSERT_TEMP_RENTAL_CUSTOMER=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.TEMP_RENTAL_CUSTOMER(CUST_ID,CUSTOMER_NAME,UNITNO)
	SELECT CC_CUST_ID,IF(CC_FIRST_NAME=CC_LAST_NAME,CC_FIRST_NAME, CONCAT(CC_FIRST_NAME,"_",CC_LAST_NAME)),CC_UNIT_NO FROM ',DESTINATIONSCHEMA,'.TEMP_CUSTOMER_SCDB_FORMAT'));
	PREPARE INSERT_TEMP_RENTAL_CUSTOMER_STMT FROM @INSERT_TEMP_RENTAL_CUSTOMER;
    EXECUTE INSERT_TEMP_RENTAL_CUSTOMER_STMT;
	SET @UPDATE_TEMP_RENTAL_CUSTOMER=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_RENTAL_CUSTOMER SET CUSTOMER_NAME=',"'MAN_MAN'",' WHERE CUSTOMER_NAME=',"'MAN'"' AND UNITNO=',"'3906'"));
	PREPARE UPDATE_TEMP_RENTAL_CUSTOMER_STMT FROM @UPDATE_TEMP_RENTAL_CUSTOMER;
    EXECUTE UPDATE_TEMP_RENTAL_CUSTOMER_STMT;
    SET FOREIGN_KEY_CHECKS=1; 
SET ENDTIME=(SELECT CURTIME());
SET DURATION=(SELECT TIMEDIFF(ENDTIME,STARTTIME));
DROP TABLE IF EXISTS TEMP_DURATION_PAYMENT_PART1;
CREATE TABLE TEMP_DURATION_PAYMENT_PART1(ID INTEGER PRIMARY KEY AUTO_INCREMENT,SPLITTING_DURATION1 TIME);
INSERT INTO TEMP_DURATION_PAYMENT_PART1(SPLITTING_DURATION1)VALUES(DURATION);
COMMIT;	
END;
