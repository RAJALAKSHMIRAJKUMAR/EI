-- version:1.5 -- sdate:18/06/2014 -- edate:18/06/2014 -- issue:805 --commentno#26,28 --desc:added cgn_id in ocbc_configuration(78,79,80)  --done by:RL
-- version:1.4 -- sdate:12/06/2014 -- edate:12/06/2014 -- issue:598 --commentno#63 --desc:removed left join queries  --done by:RL & dhivya
-- version:1.3 -- sdate:09/06/2014 -- edate:09/06/2014 -- issue:566 --comment no#12 --desc:IMPLEMENTED ROLLBACK AND COMMIT --done by:DHIVYA
-- version:1.2 -- sdate:23/05/2014 -- edate:23/05/2014 -- issue:765 --comment no#157 --desc:ADDED CGN_ID 76 IN CUSTOMER CONFIGURATION TABLE --done by:RL
-- version:1.1 -- sdate:12/05/2014 -- edate:12/05/2014 -- issue:765 --desc:changed insert query order for expense_configuration --COMMENTNO#110 --done by:RL
-- version:1.0 -- sdate:08/05/2014 -- edate:08/05/2014 -- issue:765 --desc:added 1 insert query for insert values in expense configuration table --COMMENTNO#110 --done by:RL
-- version:0.9 -- sdate:10/04/2014 -- edate:10/04/2014 -- issue:765 --desc:added SCDB  1/4/2014 TIME STAMP FOR ALL SS RECORDS --done by:RL
-- version:0.8 --sdate:01/04/2014 --edate:01/04/2014 --issue:765 --commentno#53 --desc:SPLIT THE CONFIG MIG  SP INTO 4 PART. --dONEBY:RL
-- version:0.7 --sdate:28/03/2013 --edate:28/03/2014 --issue:783 --desc:changed ALL FOREIGN KEY REFERENCES TABLE SHOULD IN DESTINATION SCHEMA --doneby:RL
--VER:0.6 STARTDATE:28/03/2014 ENDDATE:28/03/2014 ISSUENO:783 DESC:CHANGED THE SP:SP_MIG_CONFIG_INSERT  REMOVED THE DESTINATION SCHEMA IN POST_AUDIT_HISTORY DONE BY:LALITHA
--VER:0.5 STARTDATE:25/03/2014 ENDDATE:25/03/2014 ISSUENO:765 COMMENTNO:#8 DESC:CHANGED THE SP:SP_MIG_CONFIG_INSERT CHANGED THE SCHEMA FOR INSERTION IN POST AUDIT HISTORY AND UPDATION IN PRE AUDIT SUB PROFILE  DONE BY:LALITHA
-- version:0.4 -- sdate:20/03/2014 -- edate:22/03/2014 -- issue:765 -- desc:Changed the SP:SP_MIG_CONFIG_INSERT As prepared stmt for dynamic running purpose --Doneby:Lalitha
-- version:0.3 -- sdate:17/03/2014 -- edate:17/03/2014 -- issue:765 -- desc:droped temp table -- doneby:RL
-- version:0.2 -- sdate:25/02/2014 -- edate:25/02/2014 -- issue:750 -- desc:getting userstamp n time stamp from db & userstamp changed as uld_id -- doneby:RL
-- version:0.1 -- sdate:20/02/2014 -- edate:21/02/2014 -- issue:750 -- desc:Implementing audit table insert -- doneby:RL
DROP PROCEDURE IF EXISTS SP_MIG_CONFIG_INSERT1;
CREATE PROCEDURE SP_MIG_CONFIG_INSERT1(IN SOURCESCHEMA  VARCHAR(40),IN DESTINATIONSCHEMA  VARCHAR(40),IN MIGUSERSTAMP VARCHAR(50))
BEGIN
	DECLARE MIN_CCN_ID INTEGER;
	DECLARE MAX_CCN_ID INTEGER;
	DECLARE CCNUSERSTAMP VARCHAR(50);
	DECLARE CCNTIMESTAMP VARCHAR(50);
	DECLARE MIN_PCN_ID INTEGER;
	DECLARE MAX_PCN_ID INTEGER;
	DECLARE PAY_DATA TEXT;
	DECLARE START_TIME TIME;
	DECLARE END_TIME TIME;
	DECLARE DURATION TIME;
	DECLARE PAYUSERSTAMP VARCHAR(50);
	DECLARE PAYTIMESTAMP VARCHAR(50);
	DECLARE CFDATA TEXT;
	DECLARE MIN_ACN_ID INTEGER;
	DECLARE MAX_ACN_ID INTEGER;
	DECLARE ACCESS_DATA TEXT;
	DECLARE ACCESSDATA TEXT;
	DECLARE ACCESSUSERSTAMP VARCHAR(50);
	DECLARE ACCESSTIMESTAMP VARCHAR(50);
	DECLARE MIN_OCN_ID INTEGER;
	DECLARE MAX_OCN_ID INTEGER;
	DECLARE OCBCDATA TEXT;
	DECLARE OCBCCFDATA TEXT;
	DECLARE OCBCUSERSTAMP VARCHAR(50);
	DECLARE OCBCTIMESTAMP VARCHAR(50);
	DECLARE MIN_ECN_ID INTEGER;
	DECLARE MAX_ECN_ID INTEGER;
	DECLARE EXPENSE_DATA TEXT;
	DECLARE EXPENSEDATA TEXT;
	DECLARE EXPENSEUSERSTAMP VARCHAR(50);
	DECLARE EXPENSETIMESTAMP VARCHAR(50);
	DECLARE CONFIG_DATA TEXT;
	DECLARE EXPENSEID INTEGER;
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN
		ROLLBACK;
	END;
	START TRANSACTION;
	SET FOREIGN_KEY_CHECKS=0;
    SET @LOGIN_ID=(SELECT CONCAT('SELECT ULD_ID INTO @ULDID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',MIGUSERSTAMP,'"'));
    PREPARE LOGINID_STMT FROM @LOGIN_ID;
    EXECUTE LOGINID_STMT;
	SET START_TIME = (SELECT CURTIME());
		SET @DROP_CUSTOMER_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION'));
	PREPARE DROP_CUSTOMER_CONFIGURATIONSTMT FROM @DROP_CUSTOMER_CONFIGURATION;
    EXECUTE DROP_CUSTOMER_CONFIGURATIONSTMT;
	SET @CREATE_CUSTOMER_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION(
	CCN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	CCN_DATA TEXT NOT NULL,
	CCN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	CCN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(CCN_ID),FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE CREATE_CUSTOMER_CONFIGURATION_STMT FROM @CREATE_CUSTOMER_CONFIGURATION;
	EXECUTE CREATE_CUSTOMER_CONFIGURATION_STMT;
	SET @INSERT_CUSTOMER_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION(CCN_DATA,CGN_ID,CCN_INITIALIZE_FLAG,ULD_ID,CCN_TIMESTAMP)
	SELECT CSQL.DATA,CSQL.CGN_ID,CSQL.INITIALIZE_FLAG,ULD.ULD_ID,CSQL.TIMESTAMP FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSQL, ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD WHERE ULD.ULD_LOGINID = CSQL.USER_STAMP AND CGN_ID IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,33,39,47,50,53,54,75,76) AND CSQL.DATA IS NOT NULL ORDER BY CSQL.ID'));
	PREPARE INSERT_CUSTOMER_CONFIGURATION_STMT FROM @INSERT_CUSTOMER_CONFIGURATION;
	EXECUTE INSERT_CUSTOMER_CONFIGURATION_STMT;
	SET @MINCCN_ID = (SELECT CONCAT('SELECT MIN(CCN_ID) INTO @MINCCNID FROM ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION'));
	PREPARE MINCCN_ID_STMT FROM @MINCCN_ID;
	EXECUTE MINCCN_ID_STMT;
	SET @MAXCCN_ID = (SELECT CONCAT('SELECT MAX(CCN_ID) INTO @MAXCCNID FROM ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION'));
	PREPARE MAXCCN_ID_STMT FROM @MAXCCN_ID;
	EXECUTE MAXCCN_ID_STMT;
	SET MIN_CCN_ID = @MINCCNID;
	SET MAX_CCN_ID = @MAXCCNID;
	SET @CUSTS_DATA=NULL;
	SET @CC_DATA=NULL;
	WHILE(MIN_CCN_ID  <= MAX_CCN_ID)DO
		SET @CUSTOMERDATA = (SELECT CONCAT('SELECT CCN_DATA INTO @CUSTS_DATA FROM ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION WHERE CCN_ID=',MIN_CCN_ID));
		PREPARE CUSTOMERDATA_STMT FROM @CUSTOMERDATA;
		EXECUTE CUSTOMERDATA_STMT;
		SET @SETCCDATA = (SELECT CONCAT('SELECT CF_DATA INTO @CC_DATA FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA=@CUSTS_DATA'));
		PREPARE CCDATA_STMT FROM @SETCCDATA;
		EXECUTE CCDATA_STMT;
		SET CFDATA = @CC_DATA;
		IF(CFDATA IS NOT NULL)THEN
			SET @CUSERSTAMP = (SELECT CONCAT('SELECT USERSTAMP INTO @CUST_USERSTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = @CUSTS_DATA'));
			PREPARE CUSERSTAMP_STMT FROM @CUSERSTAMP;
			EXECUTE CUSERSTAMP_STMT;
			SET CCNUSERSTAMP = @CUST_USERSTAMP ;
			SET @CTIME_STAMP = (SELECT CONCAT('SELECT TIMESTAMP INTO @CUST_TIMESTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = @CUSTS_DATA'));
			PREPARE CTIME_STAMP_STMT FROM @CTIME_STAMP;
			EXECUTE CTIME_STAMP_STMT;
			SET CCNTIMESTAMP = @CUST_TIMESTAMP;
			SET @CUPDATE_TIMESTAMP = (SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION SET ULD_ID=(SELECT ULD_ID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',CCNUSERSTAMP,'"',')',',CCN_TIMESTAMP=','"',CCNTIMESTAMP,'"',' WHERE CCN_ID=',MIN_CCN_ID));
			PREPARE CUPDATE_TIMESTAMP_STMT FROM @CUPDATE_TIMESTAMP;
			EXECUTE CUPDATE_TIMESTAMP_STMT;
		END IF;
		SET @CUSTS_DATA=NULL;
		SET @CC_DATA =NULL;
		SET @CUST_USERSTAMP=NULL;
		SET @CUST_TIMESTAMP =NULL;
		SET MIN_CCN_ID = MIN_CCN_ID+1;
	END WHILE;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTCUSTOMERCONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(DATA) INTO @COUNT_CUSTOMER_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT   WHERE DATA IS NOT NULL AND CGN_ID IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,33,39,47,50,53,54,75,76)'));
	PREPARE COUNTCUSTOMERCONFIGURATIONSQLFORMATSTMT FROM @COUNTCUSTOMERCONFIGURATIONSQLFORMAT;
    EXECUTE COUNTCUSTOMERCONFIGURATIONSQLFORMATSTMT;
	SET @COUNTSPLITINGCUSTOMERCONFIGURATION=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_CUSTOMER_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.CUSTOMER_CONFIGURATION'));
	PREPARE COUNTSPLITINGCUSTOMERCONFIGURATIONSTMT FROM @COUNTSPLITINGCUSTOMERCONFIGURATION;
    EXECUTE COUNTSPLITINGCUSTOMERCONFIGURATIONSTMT;
	SET @REJECTION_COUNT=(@COUNT_CUSTOMER_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_CUSTOMER_CONFIGURATION);
	SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='CUSTOMER_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='CUSTOMER_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_CUSTOMER_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='CUSTOMER_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES
	(@POSTAPID,@COUNT_SPLITING_CUSTOMER_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID);  
	SET START_TIME = (SELECT CURTIME());
	SET @DROP_UNIT_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.UNIT_CONFIGURATION'));
	PREPARE DROP_UNIT_CONFIGURATION_STMT FROM @DROP_UNIT_CONFIGURATION;
    EXECUTE DROP_UNIT_CONFIGURATION_STMT;
	SET @CREATE_UNIT_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.UNIT_CONFIGURATION(
	UCN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	UCN_DATA TEXT NOT NULL,
	UCN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	UCN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(UCN_ID),
	FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE CREATE_UNIT_CONFIGURATION_STMT FROM @CREATE_UNIT_CONFIGURATION;
    EXECUTE CREATE_UNIT_CONFIGURATION_STMT;
	SET @INSERT_UNIT_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.UNIT_CONFIGURATION(CGN_ID,UCN_DATA,UCN_INITIALIZE_FLAG,UCN_TIMESTAMP,ULD_ID) 
	(SELECT CSQL.CGN_ID,CSQL.DATA,CSQL.INITIALIZE_FLAG,CSQL.TIMESTAMP,ULD.ULD_ID FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSQL,',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD WHERE  CSQL.DATA IS NOT NULL AND CSQL.CGN_ID=32 AND CSQL.USER_STAMP=ULD.ULD_LOGINID ORDER BY CSQL.ID)'));
	PREPARE INSERT_UNIT_CONFIGURATION_STMT FROM @INSERT_UNIT_CONFIGURATION;
    EXECUTE INSERT_UNIT_CONFIGURATION_STMT;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTUNITCONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(DATA) INTO @COUNT_UNIT_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT WHERE DATA IS NOT NULL AND CGN_ID=32'));
	PREPARE COUNTUNITCONFIGURATIONSQLFORMAT_STMT FROM @COUNTUNITCONFIGURATIONSQLFORMAT;
    EXECUTE COUNTUNITCONFIGURATIONSQLFORMAT_STMT;
	SET @COUNTSPLITINGUNITCONFIGURATION =(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_UNIT_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.UNIT_CONFIGURATION'));
	PREPARE COUNTSPLITINGUNITCONFIGURATION_STMT FROM @COUNTSPLITINGUNITCONFIGURATION;
    EXECUTE COUNTSPLITINGUNITCONFIGURATION_STMT;
	SET @REJECTION_COUNT=(@COUNT_UNIT_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_UNIT_CONFIGURATION);
	SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='UNIT_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='UNIT_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_UNIT_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='UNIT_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES
	(@POSTAPID,@COUNT_SPLITING_UNIT_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID); 
	SET START_TIME = (SELECT CURTIME());
	SET @DROP_PAYMENT_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION'));
	PREPARE DROP_PAYMENT_CONFIGURATION_STMT FROM @DROP_PAYMENT_CONFIGURATION;
    EXECUTE DROP_PAYMENT_CONFIGURATION_STMT;
	SET @CREATE_PAYMENT_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION(
	PCN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	PCN_DATA TEXT NOT NULL,
	PCN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	PCN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(PCN_ID),
	FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE CREATE_PAYMENT_CONFIGURATION_STMT FROM @CREATE_PAYMENT_CONFIGURATION;
    EXECUTE CREATE_PAYMENT_CONFIGURATION_STMT;
	SET @INSERT_PAYMENT_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION(PCN_DATA,CGN_ID,PCN_INITIALIZE_FLAG,ULD_ID,PCN_TIMESTAMP)
	SELECT CSF.DATA,CSF.CGN_ID,CSF.INITIALIZE_FLAG,ULD.ULD_ID,CSF.TIMESTAMP FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSF,',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD WHERE CSF.CGN_ID IN  (28,49,58) AND CSF.DATA IS NOT NULL AND ULD.ULD_LOGINID=CSF.USER_STAMP ORDER BY CSF.ID'));
	PREPARE INSERT_PAYMENT_CONFIGURATION_STMT FROM @INSERT_PAYMENT_CONFIGURATION;
	EXECUTE INSERT_PAYMENT_CONFIGURATION_STMT;
	SET @MINPCN_ID = (SELECT CONCAT('SELECT MIN(PCN_ID) INTO @MINPCNID FROM ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION'));
	PREPARE MINPCN_ID_STMT FROM @MINPCN_ID;
	EXECUTE MINPCN_ID_STMT;
	SET @MAXPCN_ID = (SELECT CONCAT('SELECT MAX(PCN_ID) INTO @MAXPCNID FROM ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION'));
	PREPARE MAXPCN_ID_STMT FROM @MAXPCN_ID;
	EXECUTE MAXPCN_ID_STMT;
	SET MIN_PCN_ID = @MINPCNID;
	SET MAX_PCN_ID = @MAXPCNID;
	SET @PCNDATA = NULL;
	SET @PAYDATA = NULL;
	WHILE(MIN_PCN_ID  <= MAX_PCN_ID)DO
		SET @SETPCNDATA = (SELECT CONCAT('SELECT PCN_DATA INTO @PCNDATA FROM ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION WHERE PCN_ID=',MIN_PCN_ID,''));
		PREPARE SETPCNDATA_STMT FROM @SETPCNDATA;
		EXECUTE SETPCNDATA_STMT;
		SET PAY_DATA = @PCNDATA;
		SET @SETPAYDATA = (SELECT CONCAT('SELECT CF_DATA INTO @PAYDATA FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA=','"',PAY_DATA,'"'));
		PREPARE SETPAYDATA_STMT FROM @SETPAYDATA;
		EXECUTE SETPAYDATA_STMT;
		SET CFDATA = @PAYDATA;
		IF(CFDATA IS NOT NULL)THEN
			SET @PUSERSTAMP = (SELECT CONCAT('SELECT USERSTAMP INTO @PAY_USERSTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',PAY_DATA,'"'));
			PREPARE PUSERSTAMP_STMT FROM @PUSERSTAMP;
			EXECUTE PUSERSTAMP_STMT;
			SET PAYUSERSTAMP = @PAY_USERSTAMP;
			SET @TIME_STAMP = (SELECT CONCAT('SELECT TIMESTAMP INTO @PAY_TIMESTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',PAY_DATA,'"'));
			PREPARE TIME_STAMP_STMT FROM @TIME_STAMP;
			EXECUTE TIME_STAMP_STMT;
			SET PAYTIMESTAMP = @PAY_TIMESTAMP;
			SET @UPDATE_TIMESTAMP = (SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION SET ULD_ID=(SELECT ULD_ID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',PAYUSERSTAMP,'"',')',',PCN_TIMESTAMP=','"',PAYTIMESTAMP,'"',' WHERE PCN_ID=',MIN_PCN_ID));
			PREPARE UPDATE_TIMESTAMP_STMT FROM @UPDATE_TIMESTAMP;
			EXECUTE UPDATE_TIMESTAMP_STMT;
		END IF;
		SET @PCNDATA=NULL;
		SET @PAYDATA=NULL;
		SET @PAY_USERSTAMP=NULL;
		SET @PAY_TIMESTAMP=NULL;
		SET MIN_PCN_ID = MIN_PCN_ID+1;
	END WHILE;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTPAYMENTCONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_PAYMENT_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSF,',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD WHERE CSF.CGN_ID IN  (28,49,58) AND CSF.DATA IS NOT NULL AND ULD.ULD_LOGINID=CSF.USER_STAMP'));
	PREPARE COUNTPAYMENTCONFIGURATIONSQLFORMAT_STMT FROM @COUNTPAYMENTCONFIGURATIONSQLFORMAT;
    EXECUTE COUNTPAYMENTCONFIGURATIONSQLFORMAT_STMT;
	SET @COUNTSPLITINGPAYMENTCONFIGURATION=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_PAYMENT_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.PAYMENT_CONFIGURATION'));
	PREPARE COUNTSPLITINGPAYMENTCONFIGURATION_STMT FROM @COUNTSPLITINGPAYMENTCONFIGURATION;
    EXECUTE COUNTSPLITINGPAYMENTCONFIGURATION_STMT;
	SET @REJECTION_COUNT=(@COUNT_PAYMENT_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_PAYMENT_CONFIGURATION);
    SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='PAYMENT_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='PAYMENT_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_PAYMENT_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='PAYMENT_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES
	(@POSTAPID,@COUNT_SPLITING_PAYMENT_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID);
	SET START_TIME = (SELECT CURTIME());
	SET @DROP_ACCESS_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION'));
	PREPARE DROP_ACCESS_CONFIGURATION_STMT FROM @DROP_ACCESS_CONFIGURATION;
    EXECUTE DROP_ACCESS_CONFIGURATION_STMT;
	SET @CREATE_ACCESS_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION(
	ACN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	ACN_DATA TEXT NOT NULL,
	ACN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	ACN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(ACN_ID),
	FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE CREATE_ACCESS_CONFIGURATION_STMT FROM @CREATE_ACCESS_CONFIGURATION;
	EXECUTE CREATE_ACCESS_CONFIGURATION_STMT;
	SET @INSERT_ACCESS_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION(ACN_DATA,CGN_ID,ACN_INITIALIZE_FLAG,ULD_ID,ACN_TIMESTAMP)
	(SELECT DISTINCT(CSQL.DATA),CSQL.CGN_ID,CSQL.INITIALIZE_FLAG,ULD.ULD_ID,CSQL.TIMESTAMP FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSQL, ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD  WHERE CSQL.DATA IS NOT NULL AND CGN_ID IN (16,17) AND ULD.ULD_LOGINID=CSQL.USER_STAMP ORDER BY CSQL.ID)'));
	PREPARE INSERT_ACCESS_CONFIGURATION_STMT FROM @INSERT_ACCESS_CONFIGURATION;
	EXECUTE INSERT_ACCESS_CONFIGURATION_STMT;
	SET @MINACN_ID = (SELECT CONCAT('SELECT MIN(ACN_ID) INTO @MINACNID FROM ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION'));
	PREPARE MINACN_ID_STMT FROM @MINACN_ID;
	EXECUTE MINACN_ID_STMT;
	SET @MAXACN_ID = (SELECT CONCAT('SELECT MAX(ACN_ID) INTO @MAXACNID FROM ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION'));
	PREPARE MAXACN_ID_STMT FROM @MAXACN_ID;
	EXECUTE MAXACN_ID_STMT;
	SET MIN_ACN_ID = @MINACNID;
	SET MAX_ACN_ID = @MAXACNID;
	SET @ACNDATA = NULL;
	SET @ACCDATA = NULL;
	WHILE(MIN_ACN_ID  <= MAX_ACN_ID)DO
		SET @SETACNDATA = (SELECT CONCAT('SELECT ACN_DATA INTO @ACNDATA FROM ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION WHERE ACN_ID=',MIN_ACN_ID,''));
		PREPARE SETACNDATA_STMT FROM @SETACNDATA;
		EXECUTE SETACNDATA_STMT;
		SET ACCESS_DATA = @ACNDATA;
		SET @SETACCDATA = (SELECT CONCAT('SELECT CF_DATA INTO @ACCDATA FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA=','"',ACCESS_DATA,'"'));
		PREPARE SETACCDATA_STMT FROM @SETACCDATA;
		EXECUTE SETACCDATA_STMT;
		SET ACCESSDATA = @ACCDATA;
		IF(ACCESSDATA IS NOT NULL)THEN
			SET @AUSERSTAMP = (SELECT CONCAT('SELECT USERSTAMP INTO @ACCESS_USERSTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',ACCESS_DATA,'"'));
			PREPARE AUSERSTAMP_STMT FROM @AUSERSTAMP;
			EXECUTE AUSERSTAMP_STMT;
			SET ACCESSUSERSTAMP = @ACCESS_USERSTAMP;
			SET @ATIME_STAMP = (SELECT CONCAT('SELECT TIMESTAMP INTO @ACCESS_TIMESTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',ACCESS_DATA,'"'));
			PREPARE ATIME_STAMP_STMT FROM @ATIME_STAMP;
			EXECUTE ATIME_STAMP_STMT;
			SET ACCESSTIMESTAMP = @ACCESS_TIMESTAMP;
			SET @UPDATE_ACN = (SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION SET ULD_ID=(SELECT ULD_ID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',ACCESSUSERSTAMP,'"',')',',ACN_TIMESTAMP=','"',ACCESSTIMESTAMP,'"',' WHERE ACN_ID=',MIN_ACN_ID));
			PREPARE UPDATE_ACN_STMT FROM @UPDATE_ACN;
			EXECUTE UPDATE_ACN_STMT;
		END IF;
		SET @ACCDATA=NULL;
		SET @ACNDATA=NULL;
		SET @ACCESS_USERSTAMP=NULL;
		SET @ACCESS_TIMESTAMP=NULL;
		SET MIN_ACN_ID = MIN_ACN_ID+1;
	END WHILE;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTACCESSCONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(DATA) INTO @COUNT_ACCESS_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSQL WHERE CSQL.DATA IS NOT NULL AND CGN_ID IN (16,17)'));
	PREPARE COUNTACCESSCONFIGURATIONSQLFORMAT_STMT FROM @COUNTACCESSCONFIGURATIONSQLFORMAT;
    EXECUTE COUNTACCESSCONFIGURATIONSQLFORMAT_STMT;
	SET @COUNTSPLITINGACCESSCONFIGURATION=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_ACCESS_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.ACCESS_CONFIGURATION'));
	PREPARE COUNTSPLITINGACCESSCONFIGURATION_STMT FROM @COUNTSPLITINGACCESSCONFIGURATION;
    EXECUTE COUNTSPLITINGACCESSCONFIGURATION_STMT;
	SET @REJECTION_COUNT=(@COUNT_ACCESS_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_ACCESS_CONFIGURATION);
    SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='ACCESS_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='ACCESS_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_ACCESS_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='ACCESS_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES(@POSTAPID,@COUNT_SPLITING_ACCESS_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID);  
	SET START_TIME = (SELECT CURTIME());
	SET @DROP_OCBC_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION'));
	PREPARE DROP_OCBC_CONFIGURATION_STMT FROM @DROP_OCBC_CONFIGURATION;
	EXECUTE DROP_OCBC_CONFIGURATION_STMT;
	SET @CREATE_OCBC_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION(
	OCN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	OCN_DATA TEXT NOT NULL,
	OCN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	OCN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(OCN_ID),
	FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
	PREPARE CREATE_OCBC_CONFIGURATION_STMT FROM @CREATE_OCBC_CONFIGURATION;
    EXECUTE CREATE_OCBC_CONFIGURATION_STMT;
	SET @INSERT_OCBC_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION(OCN_DATA,CGN_ID,OCN_INITIALIZE_FLAG,ULD_ID,OCN_TIMESTAMP)
	SELECT CSF.DATA,CSF.CGN_ID,CSF.INITIALIZE_FLAG,ULD.ULD_ID,CSF.TIMESTAMP FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSF,',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD WHERE CSF.CGN_ID IN (29,78,79,80) AND CSF.DATA IS NOT NULL AND ULD.ULD_LOGINID=CSF.USER_STAMP ORDER BY CSF.ID'));
	PREPARE INSERT_OCBC_CONFIGURATION_STMT FROM @INSERT_OCBC_CONFIGURATION;
	EXECUTE INSERT_OCBC_CONFIGURATION_STMT;
	SET @MINOCN_ID = (SELECT CONCAT('SELECT MIN(OCN_ID) INTO @MINOCNID FROM ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION'));
	PREPARE MINOCN_ID_STMT FROM @MINOCN_ID;
	EXECUTE MINOCN_ID_STMT;
	SET @MAXOCN_ID = (SELECT CONCAT('SELECT MAX(OCN_ID) INTO @MAXOCNID FROM ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION'));
	PREPARE MAXOCN_ID_STMT FROM @MAXOCN_ID;
	EXECUTE MAXOCN_ID_STMT;
	SET MIN_OCN_ID = @MINOCNID;
	SET MAX_OCN_ID = @MAXOCNID;
	SET @OCDATA = NULL;
	SET @OC_DATA = NULL;
	WHILE(MIN_OCN_ID  <= MAX_OCN_ID)DO
		SET @SETOCNDATA = (SELECT CONCAT('SELECT OCN_DATA INTO @OCDATA FROM ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION WHERE OCN_ID=',MIN_OCN_ID,''));
		PREPARE SETOCNDATA_STMT FROM @SETOCNDATA;
		EXECUTE SETOCNDATA_STMT;
		SET OCBCDATA = @OCDATA;
		SET @SETOCDATA = (SELECT CONCAT('SELECT CF_DATA INTO @OC_DATA FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA=','"',OCBCDATA,'"'));
		PREPARE SETOCDATA_STMT FROM @SETOCDATA;
		EXECUTE SETOCDATA_STMT;
		SET OCBCCFDATA = @OC_DATA ;
		IF(OCBCCFDATA IS NOT NULL)THEN
			SET @OUSERSTAMP = (SELECT CONCAT('SELECT USERSTAMP INTO @OCBC_USERSTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',OCBCDATA,'"'));
			PREPARE OUSERSTAMP_STMT FROM @OUSERSTAMP;
			EXECUTE OUSERSTAMP_STMT;
			SET OCBCUSERSTAMP = @OCBC_USERSTAMP;
			SET @OTIME_STAMP = (SELECT CONCAT('SELECT TIMESTAMP INTO @OCBC_TIMESTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_DATA = ','"',OCBCDATA,'"'));
			PREPARE OTIME_STAMP_STMT FROM @OTIME_STAMP;
			EXECUTE OTIME_STAMP_STMT;
			SET OCBCTIMESTAMP = @OCBC_TIMESTAMP;
			SET @UPDATE_TIMESTAMP = (SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION SET ULD_ID=(SELECT ULD_ID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',OCBCUSERSTAMP,'"',')',',OCN_TIMESTAMP=','"',OCBCTIMESTAMP,'"',' WHERE OCN_ID=',MIN_OCN_ID));
			PREPARE UPDATE_TIMESTAMP_STMT FROM @UPDATE_TIMESTAMP;
			EXECUTE UPDATE_TIMESTAMP_STMT;
		END IF;
		SET @OCDATA=NULL;
		SET @OC_DATA =NULL;
		SET @OCBC_USERSTAMP=NULL;
		SET @OCBC_TIMESTAMP =NULL;
		SET MIN_OCN_ID = MIN_OCN_ID+1;
	END WHILE;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTOCBCCONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(DATA) INTO @COUNT_OCBC_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT  WHERE DATA IS NOT NULL AND CGN_ID IN (29,78,79,80)'));
	PREPARE COUNTOCBCCONFIGURATIONSQLFORMAT_STMT FROM @COUNTOCBCCONFIGURATIONSQLFORMAT;
    EXECUTE COUNTOCBCCONFIGURATIONSQLFORMAT_STMT;
	SET @COUNTSPLITINGOCBCCONFIGURATION=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_OCBC_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.OCBC_CONFIGURATION'));
	PREPARE COUNTSPLITINGOCBCCONFIGURATION_STMT FROM @COUNTSPLITINGOCBCCONFIGURATION;
    EXECUTE COUNTSPLITINGOCBCCONFIGURATION_STMT;
	SET @REJECTION_COUNT=(@COUNT_OCBC_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_OCBC_CONFIGURATION);
	SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='OCBC_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='OCBC_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_OCBC_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='OCBC_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES
	(@POSTAPID,@COUNT_SPLITING_OCBC_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID);
	SET START_TIME = (SELECT CURTIME());
	SET @DROP_EXPENSE_CONFIGURATION=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION'));
	PREPARE DROP_EXPENSE_CONFIGURATION_STMT FROM @DROP_EXPENSE_CONFIGURATION;
    EXECUTE DROP_EXPENSE_CONFIGURATION_STMT;
	SET @CREATE_EXPENSE_CONFIGURATION=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION(
	ECN_ID INTEGER NOT NULL AUTO_INCREMENT,
	CGN_ID INTEGER NOT NULL,
	ECN_DATA TEXT NOT NULL,
	ECN_INITIALIZE_FLAG    CHAR(1) NULL,
	ULD_ID INTEGER(2) NOT NULL,
	ECN_TIMESTAMP TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY(ECN_ID),
	FOREIGN KEY(CGN_ID) REFERENCES ',DESTINATIONSCHEMA,'.CONFIGURATION(CGN_ID),
	FOREIGN KEY(ULD_ID) REFERENCES ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS(ULD_ID))'));
    PREPARE CREATE_EXPENSE_CONFIGURATION_STMT FROM @CREATE_EXPENSE_CONFIGURATION;
    EXECUTE CREATE_EXPENSE_CONFIGURATION_STMT;
	SET @INSERT_TEMP_EXPENSE_CONFIGURATION=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION(ECN_DATA,CGN_ID,ECN_INITIALIZE_FLAG,ULD_ID,ECN_TIMESTAMP)
	SELECT CSQL.DATA,CSQL.CGN_ID,CSQL.INITIALIZE_FLAG,ULD.ULD_ID,CSQL.TIMESTAMP FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT CSQL,',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS ULD
	WHERE CSQL.DATA IS NOT NULL AND CSQL.CGN_ID IN(18,19,27,20,26,21,22,23,24,25,34,35,36,37,38,40,41,51,52,77) AND ULD.ULD_LOGINID = CSQL.USER_STAMP ORDER BY CSQL.ID'));
	PREPARE INSERT_TEMP_EXPENSE_CONFIGURATION_STMT FROM @INSERT_TEMP_EXPENSE_CONFIGURATION;
	EXECUTE INSERT_TEMP_EXPENSE_CONFIGURATION_STMT;  
	SET @MINECN_ID = (SELECT CONCAT('SELECT MIN(ECN_ID) INTO @MINECNID FROM ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION'));
	PREPARE MINECN_ID_STMT FROM @MINECN_ID;
	EXECUTE MINECN_ID_STMT;
	SET @MAXECN_ID = (SELECT CONCAT('SELECT MAX(ECN_ID) INTO @MAXECNID FROM ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION'));
	PREPARE MAXECN_ID_STMT FROM @MAXECN_ID;
	EXECUTE MAXECN_ID_STMT;
	SET MIN_ECN_ID = @MINECNID;
	SET MAX_ECN_ID = @MAXECNID;
	SET @CGNDATA = NULL;
	SET @ECNDATA = NULL;
	SET @CFID = NULL;
	WHILE(MIN_ECN_ID  <= MAX_ECN_ID)DO
		SET @SETCGNDATA = (SELECT CONCAT('SELECT CGN.CGN_TYPE INTO @CGNDATA FROM ',DESTINATIONSCHEMA,'.CONFIGURATION CGN WHERE CGN.CGN_ID=(SELECT CGN_ID FROM ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION WHERE ECN_ID=',MIN_ECN_ID,')'));
		PREPARE SETCGNDATA_STMT FROM @SETCGNDATA;
		EXECUTE SETCGNDATA_STMT;
		SET CONFIG_DATA = @CGNDATA;
		SET @SETECNDATA = (SELECT CONCAT('SELECT ECN_DATA INTO @ECNDATA FROM ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION WHERE ECN_ID=',MIN_ECN_ID,''));
		PREPARE SETECNDATA_STMT FROM @SETECNDATA;
		EXECUTE SETECNDATA_STMT;
		SET EXPENSE_DATA = @ECNDATA;
		SET @SETEXPDATA = (SELECT CONCAT('SELECT CF_ID INTO @CFID FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT T WHERE CF_TYPE=','"',CONFIG_DATA,'"',' AND CF_DATA=','"',EXPENSE_DATA,'"',''));
		PREPARE SETEXPDATA_STMT FROM @SETEXPDATA;
		EXECUTE SETEXPDATA_STMT;
		SET EXPENSEID = @CFID;
		IF(EXPENSEID IS NOT NULL)THEN
			SET @EXPUSERSTAMP = (SELECT CONCAT('SELECT USERSTAMP INTO @EXPENSE_USERSTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_ID = ',EXPENSEID));
			PREPARE EXPUSERSTAMP_STMT FROM @EXPUSERSTAMP;
			EXECUTE EXPUSERSTAMP_STMT;
			SET EXPENSEUSERSTAMP = @EXPENSE_USERSTAMP;
			SET @ECNTIME_STAMP = (SELECT CONCAT('SELECT TIMESTAMP INTO @EXPENSE_TIMESTAMP FROM ',DESTINATIONSCHEMA,'.TEMP_CONFIG_SCDB_FORMAT WHERE CF_ID = ',EXPENSEID));
			PREPARE ECNTIME_STAMP_STMT FROM @ECNTIME_STAMP;
			EXECUTE ECNTIME_STAMP_STMT;
			SET EXPENSETIMESTAMP = @EXPENSE_TIMESTAMP;
			SET @UPDATE_ECN = (SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION SET ULD_ID=(SELECT ULD_ID FROM ',DESTINATIONSCHEMA,'.USER_LOGIN_DETAILS WHERE ULD_LOGINID=','"',EXPENSEUSERSTAMP,'"',')',',ECN_TIMESTAMP=','"',EXPENSETIMESTAMP,'"',' WHERE ECN_ID=',MIN_ECN_ID));
			PREPARE UPDATE_ECN_STMT FROM @UPDATE_ECN;
			EXECUTE UPDATE_ECN_STMT;
		END IF;
		SET @CGNDATA =NULL;
		SET @ECNDATA=NULL;
		SET @CFID=NULL;
		SET @EXPENSE_USERSTAMP=NULL;
		SET @EXPENSE_TIMESTAMP=NULL;
		SET MIN_ECN_ID = MIN_ECN_ID+1;
	END WHILE;
	SET END_TIME = (SELECT CURTIME());
	SET DURATION=(SELECT TIMEDIFF(END_TIME,START_TIME));
	SET @COUNTEXPENSECONFIGURATIONSQLFORMAT=(SELECT CONCAT('SELECT COUNT(DATA) INTO @COUNT_EXPENSE_CONFIGURATION_SQL_FORMAT FROM ',SOURCESCHEMA,'.CONFIG_SQL_FORMAT  WHERE DATA IS NOT NULL AND CGN_ID IN(18,19,20,21,22,23,24,25,26,27,34,35,36,37,38,40,41,51,52,77)'));
	PREPARE COUNTEXPENSECONFIGURATIONSQLFORMAT_STMT FROM @COUNTEXPENSECONFIGURATIONSQLFORMAT;
    EXECUTE COUNTEXPENSECONFIGURATIONSQLFORMAT_STMT;
    SET @COUNTSPLITINGEXPENSECONFIGURATION=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNT_SPLITING_EXPENSE_CONFIGURATION FROM ',DESTINATIONSCHEMA,'.EXPENSE_CONFIGURATION'));
	PREPARE COUNTSPLITINGEXPENSECONFIGURATION_STMT FROM @COUNTSPLITINGEXPENSECONFIGURATION;
    EXECUTE COUNTSPLITINGEXPENSECONFIGURATION_STMT;
	SET @REJECTION_COUNT=(@COUNT_EXPENSE_CONFIGURATION_SQL_FORMAT-@COUNT_SPLITING_EXPENSE_CONFIGURATION);    
	SET @POSTAPID= (SELECT POSTAP_ID FROM POST_AUDIT_PROFILE WHERE POSTAP_DATA='EXPENSE_CONFIGURATION');
	SET @PREASPID = (SELECT PREASP_ID FROM PRE_AUDIT_SUB_PROFILE WHERE PREASP_DATA='EXPENSE_CONFIGURATION');
	SET @PREAMPID = (SELECT PREAMP_ID FROM PRE_AUDIT_MAIN_PROFILE WHERE PREAMP_DATA='CONFIGURATION');
	SET @DUR=DURATION;
	UPDATE PRE_AUDIT_SUB_PROFILE SET PREASP_NO_OF_REC=@COUNT_EXPENSE_CONFIGURATION_SQL_FORMAT WHERE PREASP_DATA='EXPENSE_CONFIGURATION';    
	INSERT INTO POST_AUDIT_HISTORY(POSTAP_ID,POSTAH_NO_OF_REC,PREASP_ID,PREAMP_ID,POSTAH_DURATION,POSTAH_NO_OF_REJ,ULD_ID)VALUES
	(@POSTAPID,@COUNT_SPLITING_EXPENSE_CONFIGURATION,@PREASPID,@PREAMPID,@DUR,@REJECTION_COUNT,@ULDID);     
	SET FOREIGN_KEY_CHECKS = 1;
COMMIT;
END;
CALL SP_MIG_CONFIG_INSERT1(SOURCESCHEMA,DESTINATIONSCHEMA,MIGUSERSTAMP);