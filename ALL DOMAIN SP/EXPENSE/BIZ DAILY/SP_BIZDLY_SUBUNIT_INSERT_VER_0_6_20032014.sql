--> VERSION:0.6 -->STARTDATE:20/03/2014 -->ENDDATE20/03/2014 -->ISSUE NO:535 -->COMMENT NO:#280 -->DESC:SHOW ECN_DATA WHEN THE RECORD IS NOT SAVED,CHECKED CONDITION FOR CATEGORY ID-->DONEBY:SARADAMBAL
--> VERSION:0.5 -->STARTDATE:18/03/2014 -->ENDDATE18/03/2014 -->ISSUE NO:535 -->COMMENT NO:#272 -->DESC:CHANGING ECNDATA INTO ECNID-->DONEBY:BHAVANI.R
--> VERSION:0.4 -->STARTDATE:17/03/2014 -->ENDDATE17/03/2014 -->ISSUE NO:762 -->COMMENT NO:#8 -->DESC:setting the flag  -->DONEBY:BHAVANI.R
--> VERSION:0.3 -->STARTDATE:15/03/2014 -->ENDDATE15/03/2014 -->ISSUE NO:535 -->COMMENT NO:253 -->DESC:CHECKING MANDATORY FIELDS ARE NULL OR NOT NULL  -->DONEBY:BHAVANI.R
--> VERSION:0.2 -->STARTDATE:13/03/2014 -->ENDDATE:13/03/2014 -->ISSUE NO:752 -->COMMENT NO:#3 -->DESC:CHANGING COMMENTS IN MAIN SP SP_EXPENSE_UNIT_INSERT -->DONEBY:BHAVANI.R
--> VERSION:0.1 -->STARTDATE:11/03/2014 -->ENDDATE12/03/2014 -->ISSUE NO:762-->DESC:CREATION OF SP SP_EXPENSE_UNIT_INSERT FOR INSERTION -->DONEBY:BHAVANI.R
DROP PROCEDURE IF EXISTS SP_BIZDLY_SUBUNIT_INSERT;
CREATE PROCEDURE SP_BIZDLY_SUBUNIT_INSERT(
IN EUUNITNO TEXT,
IN EUECNID TEXT,
IN EUCUSTOMERID TEXT,
IN EUINVOICEDATE DATE,
IN EUAMOUNT DECIMAL(7,2),
IN EUINVOICEITEM TEXT,
IN EUINVOICEFROM VARCHAR(200),
IN EUCOMMENTS TEXT,
IN USERSTAMP VARCHAR(50),
OUT SUCCESS_FLAG INTEGER)
BEGIN
    DECLARE USERSTAMP_ID INTEGER(2);
--  QUERY FOR ROLLBACK COMMAND
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET SUCCESS_FLAG = 0;
        ROLLBACK;
    END;
   
  --  QUERY FOR CALL SP_CHANGE_USERSTAMP_AS_ULDID
    CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
    SET USERSTAMP_ID = (SELECT @ULDID);
 
--  QUERY FOR SET NULL FOR EUUNITNO
    IF(EUUNITNO='' OR EUUNITNO IS NULL)THEN
        SET EUUNITNO = NULL;
    END IF;
--  QUERY FOR SET NULL FOR EUECNID
  IF (EUECNID='' OR EUECNID IS NULL)THEN
        SET EUECNID=NULL;
  END IF;
--  QUERY FOR SET NULL FOR EUCUSTOMERID
  IF(EUCUSTOMERID='' OR EUCUSTOMERID IS NULL)THEN
        SET EUCUSTOMERID = NULL;
    END IF;
 
  --  QUERY FOR SET NULL FOR EUINVOICEDATE
    IF(EUINVOICEDATE='' OR EUINVOICEDATE IS NULL)THEN
        SET EUINVOICEDATE = NULL;
    END IF;

--  QUERY FOR SET NULL FOR EUAMOUNT
    IF(EUAMOUNT='' OR EUAMOUNT IS NULL)THEN
        SET EUAMOUNT = NULL;
    END IF;
--  QUERY FOR SET NULL FOR EUINVOICEITEM
    IF(EUINVOICEITEM='' OR EUINVOICEITEM IS NULL)THEN
        SET EUINVOICEITEM = NULL;
    END IF;
--  QUERY FOR SET NULL FOR EUINVOICEFROM
    IF(EUINVOICEFROM='' OR EUINVOICEFROM IS NULL)THEN
        SET EUINVOICEFROM = NULL;
    END IF;
--  QUERY FOR SET NULL FOR EUCOMMENTS
    IF(EUCOMMENTS='' OR EUCOMMENTS IS NULL)THEN
        SET EUCOMMENTS = NULL;
    END IF;
--  QUERY FOR SET NULL FOR USERSTAMP
    IF(USERSTAMP='' OR USERSTAMP IS NULL)THEN
        SET USERSTAMP = NULL;
    END IF;
   
--  QUERY FOR START TRASACTION   
    START TRANSACTION;   
  SET SUCCESS_FLAG = 0;

--  QUERY FOR INSERT VALUES IN EXPENSE_UNIT TABLE
    IF(EUUNITNO IS NOT NULL AND EUECNID IS NOT NULL AND EUINVOICEDATE IS NOT NULL AND EUAMOUNT IS NOT NULL AND EUINVOICEITEM IS NOT NULL AND EUINVOICEFROM IS NOT NULL AND USERSTAMP IS NOT NULL)THEN
          IF((EUECNID='23' AND EUCUSTOMERID IS NOT NULL) OR (EUECNID='24' AND EUCUSTOMERID IS NULL) OR(EUECNID='22' AND EUCUSTOMERID IS NULL))  THEN
            INSERT INTO EXPENSE_UNIT (UNIT_ID,ECN_ID,CUSTOMER_ID,EU_INVOICE_DATE,EU_AMOUNT,EU_INVOICE_ITEMS,
            EU_INVOICE_FROM,EU_COMMENTS,ULD_ID)VALUES((SELECT UNIT_ID FROM UNIT WHERE UNIT_NO=EUUNITNO),EUECNID,
            EUCUSTOMERID,EUINVOICEDATE,EUAMOUNT,EUINVOICEITEM,EUINVOICEFROM,EUCOMMENTS,USERSTAMP_ID);
            SET SUCCESS_FLAG = 1;
          END IF;
    END IF;
COMMIT;
END;