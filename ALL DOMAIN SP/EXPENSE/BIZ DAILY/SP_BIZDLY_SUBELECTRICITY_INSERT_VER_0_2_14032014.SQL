--version:0.2 --sdate:14/03/2014 --edate:14/03/2014 --issue:535 --comment no#253 --desc:checked mandatory fileds r cum as null or not null --doneby:RL
--version:0.1 --sdate:10/03/2014 --edate:12/03/2014 --issue:535 --comment no#224 --desc:create sp for save values in expense electricity table --doneby:RL 
DROP PROCEDURE IF EXISTS SP_BIZDLY_SUBELECTRICITY_INSERT;
CREATE PROCEDURE SP_BIZDLY_SUBELECTRICITY_INSERT(
IN INPUT_UNITNO TEXT,
IN INPUT_INVOICEDATE DATE,
IN INPUT_FROMPERIOD DATE,
IN INPUT_TOPERIOD DATE,
IN INPUT_ECNID TEXT,
IN INPUT_AMOUNT DECIMAL(7,2),
IN INPUT_COMMENTS TEXT,
IN INPUT_USERSTAMP VARCHAR(50),
OUT EESUCCESSFLAG INTEGER)
BEGIN
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EDEID INTEGER;
-- QUERY FOR ROLLBACK COMMAND
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		SET EESUCCESSFLAG = 0;
		ROLLBACK; 
	END;
-- QUERY FOR SET NULL FOR COMMENTS
	IF(INPUT_UNITNO='' OR INPUT_UNITNO IS NULL)THEN
		SET INPUT_UNITNO = NULL;
	END IF;
	
	IF(INPUT_INVOICEDATE='' OR INPUT_INVOICEDATE IS NULL)THEN
		SET INPUT_INVOICEDATE = NULL;
	END IF;
	
	IF(INPUT_FROMPERIOD='' OR INPUT_FROMPERIOD IS NULL)THEN
		SET INPUT_FROMPERIOD = NULL;
	END IF;
	
	IF(INPUT_TOPERIOD='' OR INPUT_TOPERIOD IS NULL)THEN
		SET INPUT_TOPERIOD = NULL;
	END IF;
	
	IF(INPUT_ECNID='' OR INPUT_ECNID IS NULL)THEN
		SET INPUT_ECNID = NULL;
	END IF;
	
	IF(INPUT_AMOUNT='' OR INPUT_AMOUNT IS NULL)THEN
		SET INPUT_AMOUNT = NULL;
	END IF;
	
	IF(INPUT_COMMENTS='' OR INPUT_COMMENTS IS NULL)THEN
		SET INPUT_COMMENTS = NULL;
	END IF;
	
	IF(INPUT_USERSTAMP='' OR INPUT_USERSTAMP IS NULL)THEN
		SET INPUT_USERSTAMP = NULL;
	END IF;
-- QUERY FOR START TRASACTION	
	START TRANSACTION;	
	SET EESUCCESSFLAG = 0;
-- QUERY FOR CALL SP_CHANGE_USERSTAMP_AS_ULDID
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(INPUT_USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	SET EDEID = (SELECT MAX(EDE_ID) FROM EXPENSE_DETAIL_ELECTRICITY WHERE UNIT_ID = (SELECT UNIT_ID FROM UNIT WHERE UNIT_NO = INPUT_UNITNO));
-- QUERY FOR INSERT VALUES IN EXPENSE_ELECTRICITY TABLE
	IF(INPUT_UNITNO IS NOT NULL AND INPUT_INVOICEDATE IS NOT NULL AND INPUT_FROMPERIOD IS NOT NULL AND INPUT_TOPERIOD IS NOT NULL AND INPUT_ECNID IS NOT NULL AND INPUT_AMOUNT IS NOT NULL AND INPUT_USERSTAMP IS NOT NULL)THEN
		INSERT INTO EXPENSE_ELECTRICITY (EDE_ID,EE_INVOICE_DATE,EE_FROM_PERIOD,EE_TO_PERIOD,ECN_ID,EE_AMOUNT,EE_COMMENTS,ULD_ID) VALUES 
		(EDEID,INPUT_INVOICEDATE,INPUT_FROMPERIOD,INPUT_TOPERIOD,INPUT_ECNID,INPUT_AMOUNT,INPUT_COMMENTS,USERSTAMP_ID);
		SET EESUCCESSFLAG = 1;
	END IF;
COMMIT;
END;
