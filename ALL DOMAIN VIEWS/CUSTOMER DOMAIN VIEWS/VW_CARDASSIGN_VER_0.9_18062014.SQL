-- VER 0.9 STARTDATE:18/06/2014 ENDDATE:18/06/2014 ISSUENO:345 COMMENT NO 714 DESC:CHANGED TEMP VIEW NAME AS SUB DONEBY:SASIKALA
-- VER 0.8 STARTDATE:04/05/2014 ENDDATE:04/05/2014 ISSUENO:779 COMMENT NO 6 DESC:NOT SHOWING INVALID LP IN VIEW
--VER 0.7 STARTDATE:03/04/2014 ENDDATE:03/04/2014 ISSUENO:797 COMMENTNO:#4 DESC:REPLACED HEADER ND TABLE NAME DONE BY:LALITHA
-->VER 0.6--->ISSUE NO:345 COMMENT NO:#562 START DATE:21/01/2014 ENDDATE:21/01/2014 DESC:ADDED START DATE AND END DATE COLUMN BY:SAFIYULLAH.M
-->VER 0.5--->ISSUE NO:345 COMMENT NO:#47 START DATE:22/11/2013 ENDDATE:22/11/2013 DESC:ADDED CONDITION IN VW_TEMP_CARDASSIGN VIEW DONE BY:DHIVYA.A
-->VER 0.4--->ISSUE NO:636 COMMENT NO:#47 START DATE:10/11/2013 ENDDATE:10/11/2013 DESC:CHANGED VIEW NAME BY RL
-->VER 0.3--->ISSUE NO:345 COMMENT NO:#307 START DATE:04/11/2013 ENDDATE:04/11/2013 DESC:UPDATED SYSDATE() AS CURDATE() BY:DHIVYA.A
-->VER 0.2--->ISSUE NO:345 COMMENT NO:#239 START DATE:23/10/2013 ENDDATE:23/10/2013 DESC:added cancel date is null condition in CARD_ASSIGN VIEW form BY:DHIVYA.A
-->VER 0.1--->ISSUE NO:345 COMMENT NO:#194 START DATE:18/10/2013 ENDDATE:18/10/2013 DESC:views for CARD_ASSIGN form BY:DHIVYA.A

--TEMPORARY VIEWS FOR GETTING CUSTOMER_ID ,MAX REC_VER AND CLP_TERMINATE,CLP_STARTDATE,CLP_ENDDATE,CLP_PRETERMINATE_DATE
CREATE OR REPLACE VIEW VW_SUB_CUSTOMER_MAXIMUM_RECVER AS SELECT C1.CUSTOMER_ID,MAX(C1.CED_REC_VER) AS REC_VER FROM
CUSTOMER_LP_DETAILS C1 WHERE C1.CLP_GUEST_CARD IS NULL AND IF(C1.CLP_PRETERMINATE_DATE IS NOT NULL,C1.CLP_STARTDATE<C1.CLP_PRETERMINATE_DATE,C1.CLP_STARTDATE<C1.CLP_ENDDATE ) AND C1.CLP_TERMINATE IS NULL GROUP BY C1.CUSTOMER_ID;

CREATE OR REPLACE VIEW VW_SUB_CARDASSIGN AS 
SELECT C1.CUSTOMER_ID,C.CED_REC_VER,C.CLP_STARTDATE,C.CLP_ENDDATE,C.CLP_PRETERMINATE_DATE,C.CLP_TERMINATE,U.UNIT_NO,CED.CED_CANCEL_DATE FROM
CUSTOMER_LP_DETAILS C,VW_SUB_CUSTOMER_MAXIMUM_RECVER C1,CUSTOMER_ENTRY_DETAILS CED,UNIT U WHERE C.CUSTOMER_ID=C1.CUSTOMER_ID AND C.CED_REC_VER=CED.CED_REC_VER AND CED.UNIT_ID=U.UNIT_ID AND CED.CUSTOMER_ID=C1.CUSTOMER_ID AND
IF (C.CLP_PRETERMINATE_DATE IS NOT NULL ,C.CLP_PRETERMINATE_DATE>CURDATE(),C.CLP_ENDDATE>CURDATE())AND IF(C.CLP_PRETERMINATE_DATE IS NOT NULL,C.CLP_STARTDATE<C.CLP_PRETERMINATE_DATE,C.CLP_STARTDATE<C.CLP_ENDDATE ) AND C.CLP_TERMINATE IS NULL AND C.CLP_GUEST_CARD IS NULL;

--VIEWS FOR CARD_ASSIGN
CREATE OR REPLACE VIEW VW_CARDASSIGN AS
SELECT U.UNIT_ID,T.UNIT_NO,T.CED_REC_VER,T.CUSTOMER_ID,CONCAT(C.CUSTOMER_FIRST_NAME,'_',C.CUSTOMER_LAST_NAME)AS CUSTOMERNAME,T.CLP_STARTDATE,T.CLP_ENDDATE,T.CLP_PRETERMINATE_DATE
FROM CUSTOMER C,VW_SUB_CARDASSIGN T,UNIT U WHERE C.CUSTOMER_ID=T.CUSTOMER_ID AND U.UNIT_NO=T.UNIT_NO AND
T.CLP_TERMINATE IS NULL AND T.CED_CANCEL_DATE IS NULL;