--VER 0.6 STARTDATE:18/06/2014 ENDDATE:18/06/2014 ISSUENO:345 COMMENTNO:#714 DESC:CHANGED TEMP VIEW NAME AS SUB DONE BY:SASIKALA
--VER 0.5 STARTDATE:03/04/2014 ENDDATE:04/04/2014 ISSUENO:797 COMMENTNO:#4 DESC:REPLACED HEADER ND TABLE NAME DONE BY:LALITHA
-->VER 0.4--->ISSUE NO:345 STARTDATE:25/03/2014 ENDDATE:25/03/2014,issueno 345 commentno:627-->desc:added rec version in VW_EXTENSION_CUSTOMER by PUNI
-->VER 0.3--->ISSUE NO:636 COMMENT NO:#47 START DATE:10/11/2013 ENDDATE:10/11/2013 DESC:CHANGED VIEW NAME BY RL
--VERSION 0.2 ISSUE NO:345 STARTDATE:29/10/2013 ENDDATE:29/10/2013 ISSUE NO:345 COMMENT NO:#276 DESC:added alias name for customer first name and last name DONE BY:DHIVYA.A
--VERSION 0.1 ISSUE NO:345 STARTDATE:22/10/2013 ENDDATE:23/10/2013 ISSUE NO:345 COMMENT NO:#227 DESC:VIEW FOR EXTENSION CUSTOMER DONE BY:DHIVYA.A

--TEMPORARY VIEW FOR GETTING MAXIMUM RECORD VERSION
CREATE OR REPLACE VIEW VW_SUB_EXTENSION_CUSTOMER AS 
SELECT CUSTOMER_ID,MAX(CED_REC_VER) AS RECVER FROM CUSTOMER_LP_DETAILS WHERE CLP_GUEST_CARD IS NULL AND IF(CLP_PRETERMINATE_DATE IS NOT NULL,CLP_STARTDATE<CLP_PRETERMINATE_DATE,CLP_STARTDATE )GROUP BY CUSTOMER_ID;

--TEMPORARY VIEW FOR GETTING CUSTOMERID,RECVER,CLP_TERMINATE,CANCELDATE AND UNITID
CREATE OR REPLACE VIEW VW_SUB_EXTENSION_TERMINATE_CUSTOMER AS
SELECT CTD.CUSTOMER_ID,CTD.CED_REC_VER,CTD.CLP_TERMINATE,CED.CED_CANCEL_DATE,CED.UNIT_ID FROM
CUSTOMER_LP_DETAILS CTD,CUSTOMER_ENTRY_DETAILS CED,VW_SUB_EXTENSION_CUSTOMER T
WHERE CTD.CUSTOMER_ID=CED.CUSTOMER_ID AND CTD.CUSTOMER_ID=T.CUSTOMER_ID AND CED.CUSTOMER_ID=T.CUSTOMER_ID 
AND CTD.CED_REC_VER=CED.CED_REC_VER AND T.RECVER=CED.CED_REC_VER
AND T.RECVER=CTD.CED_REC_VER AND CTD.CLP_GUEST_CARD IS NULL GROUP BY CTD.CUSTOMER_ID;

--VIEWS FOR EXTENSION CUSTOMER
CREATE OR REPLACE VIEW VW_EXTENSION_CUSTOMER AS
SELECT U.UNIT_ID,U.UNIT_NO,C.CUSTOMER_ID,CONCAT(C.CUSTOMER_FIRST_NAME,'_',C.CUSTOMER_LAST_NAME)AS CUSTOMERNAME,T.CED_REC_VER FROM
UNIT U,CUSTOMER C,VW_SUB_EXTENSION_TERMINATE_CUSTOMER T WHERE U.UNIT_ID=T.UNIT_ID AND C.CUSTOMER_ID=T.CUSTOMER_ID AND 
T.CLP_TERMINATE IS NULL AND T.CED_CANCEL_DATE IS NULL;
