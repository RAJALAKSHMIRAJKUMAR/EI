--VER 0.7 STARTDATE:18/06/2014 ENDDATE:18/06/2014 ISSUENO:345 COMMENTNO:#714 DESC:CHANGED TEMP VIEW NAME AS SUB DONE BY:SASIKALA
--VER 0.6 STARTDATE:30/05/2014 ENDDATE:31/05/2014 ISSUENO:345 COMMENTNO:#707 DESC:ADDED VW_TEMP_PAYMENT_ACTIVE_CUSTOMER_LIST AND CHANGED SOME CONDITIONS FOR DIFFERENT UNIT EXTENSION DONE BY:DHIVYA
--VER 0.5 STARTDATE:11/04/2014 ENDDATE:11/04/2014 ISSUENO:345 COMMENTNO:#659 DESC:SPLTTED TWO VIEWS ONE VIEW FOR ACTIVE LEASE PERIOD RECVER AND ANOTHER FOR ALL ACTIVE CUSTOMER ACTIVE,TERMINATED AND FUTURE RECVER DONE BY:DHIVYA
--VER 0.4 STARTDATE:03/04/2014 ENDDATE:03/04/2014 ISSUENO:797 COMMENTNO:#4 DESC:REPLACED HEADER ND TABLE NAME DONE BY:LALITHA
--VER 0.3 ISSUE NO:717 COMMENT NO:#3 STARTDATE:07/02/2013 ENDDATE:07/02/2013 DESC:ADDED CUSTOMER_PERSONAL_DETAILS TABLE IN JOIN QUERIES AND ADDED CPD.EMAIL COL IN TEMP TABLE  DONE BY:KUMAR R.
--VER 0.2 ISSUE NO:717 COMMENT NO:#3 STARTDATE:21/01/2013 ENDDATE:21/01/2013 DESC:ADDED CUSTOMER_PERSONAL_DETAILS TABLE IN CURRENT ACTIVE CUSTOMER VIEW FOR CPD_EMAIL HEADER DONE BY:DHIVYA.A
--VER 0.1 ISSUE NO:641 COMMENT NO:#3 START DATE:06/12/2013 END DATE:06/12/2013 DESC:VIEW FOR CURRENT ACTIVE CUSTOMER  DONE BY:DHIVYA.A


--TEMP VIEW FOR ACTIVE CUSTOMER
CREATE OR REPLACE VIEW VW_SUB_ACTIVE_CUSTOMER_LIST AS
SELECT C1.CUSTOMER_ID ,CONCAT(CUSTOMER_FIRST_NAME,'_',CUSTOMER_LAST_NAME)AS CUSTOMERNAME ,U.UNIT_NO,U.UNIT_ID,C.CED_REC_VER
FROM CUSTOMER C1 JOIN CUSTOMER_LP_DETAILS C JOIN CUSTOMER_ENTRY_DETAILS C2,UNIT U  WHERE
 C.CLP_TERMINATE IS NULL AND (C.CLP_STARTDATE<=CURDATE() OR C.CLP_STARTDATE>CURDATE()) AND if (C.CLP_PRETERMINATE_DATE IS NOT NULL ,C.CLP_PRETERMINATE_DATE>=CURDATE(),C.CLP_ENDDATE>=CURDATE())AND C.CUSTOMER_ID=C1.CUSTOMER_ID AND
C.CLP_GUEST_CARD IS NULL AND C.CUSTOMER_ID=C2.CUSTOMER_ID AND C2.CED_CANCEL_DATE IS NULL AND C.CED_REC_VER=C2.CED_REC_VER AND U.UNIT_ID=C2.UNIT_ID GROUP BY C.CUSTOMER_ID;


--VIEW FOR CURRENT_ACTIVE_CUSTOMER
CREATE OR REPLACE VIEW VW_CURRENT_ACTIVE_CUSTOMER AS
SELECT C.CUSTOMER_ID,C.CUSTOMER_FIRST_NAME,C.CUSTOMER_LAST_NAME,CONCAT(CUSTOMER_FIRST_NAME,' ',CUSTOMER_LAST_NAME)AS CUSTOMERNAME ,CED.CED_REC_VER,U.UNIT_NO,CTD.CLP_STARTDATE,CTD.CLP_ENDDATE,CTD.CLP_PRETERMINATE_DATE,
CED.CED_PRETERMINATE,CPD.CPD_EMAIL FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CTD,CUSTOMER C,UNIT U,VW_SUB_ACTIVE_CUSTOMER_LIST V,CUSTOMER_PERSONAL_DETAILS CPD WHERE
C.CUSTOMER_ID=CED.CUSTOMER_ID AND C.CUSTOMER_ID=CTD.CUSTOMER_ID AND C.CUSTOMER_ID=V.CUSTOMER_ID AND U.UNIT_ID=CED.UNIT_ID AND CTD.CUSTOMER_ID=CED.CUSTOMER_ID AND
 CTD.CUSTOMER_ID=V.CUSTOMER_ID AND  CED.CUSTOMER_ID=V.CUSTOMER_ID AND   CTD.CLP_GUEST_CARD IS NULL AND C.CUSTOMER_ID=CPD.CUSTOMER_ID AND
CED.CED_REC_VER=CTD.CED_REC_VER AND CPD.CUSTOMER_ID=CTD.CUSTOMER_ID AND CPD.CUSTOMER_ID=CED.CUSTOMER_ID AND  V.CUSTOMER_ID=CPD.CUSTOMER_ID AND CTD.CLP_TERMINATE IS NULL
 AND IF(CTD.CLP_PRETERMINATE_DATE IS NOT NULL,CTD.CLP_STARTDATE<CTD.CLP_PRETERMINATE_DATE,CTD.CLP_STARTDATE<CTD.CLP_ENDDATE)AND CED.CED_CANCEL_DATE IS NULL;
 
-- VIEW FOR TEMP_PAYMENT_ACTIVE_CUSTOMER_LIST
CREATE OR REPLACE VIEW VW_SUB_PAYMENT_ACTIVE_CUSTOMER_LIST AS
SELECT C1.CUSTOMER_ID ,CONCAT(CUSTOMER_FIRST_NAME,'_',CUSTOMER_LAST_NAME)AS CUSTOMERNAME ,U.UNIT_NO,U.UNIT_ID,C.CED_REC_VER
FROM CUSTOMER C1 JOIN CUSTOMER_LP_DETAILS C JOIN CUSTOMER_ENTRY_DETAILS C2,UNIT U  WHERE
 C.CLP_TERMINATE IS NULL AND (C.CLP_STARTDATE<=CURDATE() OR C.CLP_STARTDATE>CURDATE()) AND if (C.CLP_PRETERMINATE_DATE IS NOT NULL ,C.CLP_PRETERMINATE_DATE>=CURDATE(),C.CLP_ENDDATE>=CURDATE())AND C.CUSTOMER_ID=C1.CUSTOMER_ID AND
C.CLP_GUEST_CARD IS NULL AND C.CUSTOMER_ID=C2.CUSTOMER_ID AND C2.CED_CANCEL_DATE IS NULL AND C.CED_REC_VER=C2.CED_REC_VER AND U.UNIT_ID=C2.UNIT_ID;


--VIEW FOR PAYMENT_CURRENT_ACTIVE_CUSTOMER
CREATE OR REPLACE VIEW VW_PAYMENT_CURRENT_ACTIVE_CUSTOMER AS
SELECT C.CUSTOMER_ID,C.CUSTOMER_FIRST_NAME,C.CUSTOMER_LAST_NAME,CONCAT(CUSTOMER_FIRST_NAME,' ',CUSTOMER_LAST_NAME)AS CUSTOMERNAME ,CED.CED_REC_VER,U.UNIT_NO,CTD.CLP_STARTDATE,CTD.CLP_ENDDATE,CTD.CLP_PRETERMINATE_DATE,
CED.CED_PRETERMINATE,CFD.CFD_AMOUNT AS PAYMENT,CPD.CPD_EMAIL FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CTD,CUSTOMER C,UNIT U,CUSTOMER_FEE_DETAILS CFD,VW_SUB_PAYMENT_ACTIVE_CUSTOMER_LIST V,CUSTOMER_PERSONAL_DETAILS CPD WHERE
C.CUSTOMER_ID=CED.CUSTOMER_ID AND C.CUSTOMER_ID=CTD.CUSTOMER_ID AND C.CUSTOMER_ID=CFD.CUSTOMER_ID AND C.CUSTOMER_ID=V.CUSTOMER_ID AND U.UNIT_ID=CED.UNIT_ID AND CTD.CUSTOMER_ID=CED.CUSTOMER_ID AND
CTD.CUSTOMER_ID=CFD.CUSTOMER_ID AND CTD.CUSTOMER_ID=V.CUSTOMER_ID AND CED.CUSTOMER_ID=CFD.CUSTOMER_ID AND CED.CUSTOMER_ID=V.CUSTOMER_ID AND CFD.CUSTOMER_ID=CTD.CUSTOMER_ID AND CFD.CUSTOMER_ID=CED.CUSTOMER_ID AND CTD.CLP_GUEST_CARD IS NULL AND C.CUSTOMER_ID=CPD.CUSTOMER_ID AND
CPD.CUSTOMER_ID=CTD.CUSTOMER_ID AND CPD.CUSTOMER_ID=CED.CUSTOMER_ID AND CFD.CUSTOMER_ID=CPD.CUSTOMER_ID AND V.CUSTOMER_ID=CPD.CUSTOMER_ID AND CFD.CPP_ID=1 AND CFD.CED_REC_VER=CTD.CED_REC_VER AND CFD.CED_REC_VER=CED.CED_REC_VER AND IF(CTD.CLP_PRETERMINATE_DATE IS NOT NULL,
CTD.CLP_STARTDATE<CTD.CLP_PRETERMINATE_DATE,CTD.CLP_STARTDATE<CTD.CLP_ENDDATE) AND CPD.CUSTOMER_ID=C.CUSTOMER_ID AND CED.CED_CANCEL_DATE IS NULL AND (V.UNIT_ID=CED.UNIT_ID OR CED.CED_REC_VER>V.CED_REC_VER)GROUP BY CTD.CUSTOMER_ID,CTD.CED_REC_VER;