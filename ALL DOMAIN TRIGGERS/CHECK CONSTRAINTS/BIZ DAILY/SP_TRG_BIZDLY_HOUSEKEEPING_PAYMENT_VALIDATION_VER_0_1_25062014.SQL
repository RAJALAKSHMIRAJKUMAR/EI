-- version:0.1 --sdate:25-06-2014 --edate:25-06-2014 --issue:593 --commentno#75 --desc:forperiod,paiddate,unitid,ehkuid validation --doneby:RL
DROP PROCEDURE IF EXISTS SP_TRG_BIZDLY_HOUSEKEEPING_PAYMENT_VALIDATION;
CREATE PROCEDURE SP_TRG_BIZDLY_HOUSEKEEPING_PAYMENT_VALIDATION(
IN UNITID INTEGER,
IN EHKUID INTEGER,
IN FORPERIOD DATE,
IN PAIDDATE DATE,
IN PROCESS TEXT)
BEGIN
	DECLARE MESSAGE_TEXT VARCHAR(50);
	IF (PROCESS='INSERT') OR (PROCESS='UPDATE') THEN
		IF(UNITID IS NULL AND EHKUID IS NULL) OR (UNITID IS NOT NULL AND EHKUID IS NOT NULL) THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='GIVE UNIT_ID OR EHKU_ID';
		END IF;
		IF(UNITID IS NOT NULL)THEN
			IF NOT EXISTS(SELECT UNIT_ID FROM UNIT WHERE UNIT_ID = UNITID)THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='UNIT_ID NOT IN UNIT TABLE';
			END IF;
		END IF;
		IF(EHKUID IS NOT NULL)THEN
			IF NOT EXISTS(SELECT EHKU_ID FROM EXPENSE_HOUSEKEEPING_UNIT WHERE EHKU_ID = EHKUID)THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EHKU_ID NOT IN EXPENSE_HOUSEKEEPING_UNIT TABLE';
			END IF;
		END IF;
		IF FORPERIOD > CURDATE() THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EHKP_FOR_PERIOD SHOULD LESS THAN OR EQUAL TO TODAY DATE';
		END IF;
		IF PAIDDATE > CURDATE() THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EHKP_PAID_DATE SHOULD LESS THAN OR EQUAL TO TODAY DATE';
		END IF;
	END IF;
END;