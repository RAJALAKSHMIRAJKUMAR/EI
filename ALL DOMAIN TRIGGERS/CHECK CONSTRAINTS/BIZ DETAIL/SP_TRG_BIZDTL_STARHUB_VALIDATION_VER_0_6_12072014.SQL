-- version:0.6 --issue:593 --commentno#209 --sdate:12/07/2014 --edate:12/07/2013 --doneby:RL
-- VER 0.5 ISSUE NO:593  --COMMENTNO#279 STARTDATE:12/07/2014 ENDDATE:12/07/2014 DESC:added invoice date parameter in SP_CONFIG_SDATE_EDATE   DONE BY:RL
-- version:0.4 --sdate:11-07-2014 --edate:11-07-2014 --issue:593 --commentno#255 --desc:CHANGES IN SP FOR GETTING CONFIGDATE FOR UNITSTARTDATE --doneby:BHAVANI.R
-- VERSION:0.3 -- STARTDATE:05/07/2014 -- ENDDATE:05/07/2014 -- ISSUE NO:593  -- DESC changes in sp for checking EDSH_INTERNET_STARTDATE  -- DONE BY:BHAVANI.R
-- VERSION:0.2 -- STARTDATE:01/07/2014 -- ENDDATE:01/07/2014 -- ISSUE NO:593 -- COMMENT NO:193 -- DESC changes in sp for passing parameter from trigger sp -- DONE BY:BHAVANI.R
-- VERSION:0.1 -- STARTDATE:26/06/2014 -- ENDDATE:26/06/2014 -- ISSUE NO:593 -- COMMENT NO:109 -- DESC CREATING TRIGGER SP FOR INSERTING AND UPDATING IN EXPENSE_DETAIL_STARHUB -- DONE BY:BHAVANI.R
DROP PROCEDURE IF EXISTS SP_TRG_BIZDTL_STARHUB_VALIDATION;
CREATE PROCEDURE SP_TRG_BIZDTL_STARHUB_VALIDATION(
IN OLDEDSHID INTEGER,
IN NEWEDSHID INTEGER,
IN UNITID INTEGER,
IN ECNID INTEGER,
IN EDSH_APPLDATE DATE,
IN EDSH_CABLE_STARTDATE DATE,
IN EDSH_CABLE_ENDDATE DATE,
IN EDSH_INTERNET_STARTDATE DATE,
IN EDSH_INTERNET_ENDDATE DATE,
IN PROCESS TEXT)
BEGIN
	DECLARE MESSAGE_TEXT VARCHAR(50);
	DECLARE TODAYDATE DATE;
	DECLARE UNITSTARTDATE DATE;
	DECLARE UNITENDDATE DATE;
	DECLARE ENDDATE DATE;
	DECLARE MINDATE DATE;
	DECLARE MAXDATE DATE;
	CALL SP_CONFIG_SDATE_EDATE(UNITID,@S_CONFIGDATE,@E_CONFIGDATE,@INVOICE_DATE);
	SET UNITSTARTDATE=@S_CONFIGDATE;
	SET UNITENDDATE=@E_CONFIGDATE;
	SET TODAYDATE=CURDATE();
	SET MAXDATE = @INVOICE_DATE;
	SET MINDATE=UNITSTARTDATE;
	IF (PROCESS='INSERT') OR (PROCESS='UPDATE') THEN
		IF (ECNID IS NOT NULL) THEN
			IF NOT EXISTS(SELECT ECN_ID FROM EXPENSE_CONFIGURATION WHERE ECN_ID = ECNID AND CGN_ID = 27)THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT = 'GIVE ECN_ID IN BETWEEN 19 TO 21';
			END IF;
		END IF;
		IF (EDSH_APPLDATE IS NOT NULL) THEN
			IF EDSH_APPLDATE NOT BETWEEN MINDATE AND MAXDATE THEN 
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EDSH_APPL_DATE SHOULD BETWEEN UNIT STARTDATE AND ENDDATE';
			END IF;
		END IF;	
		IF(EDSH_CABLE_STARTDATE IS NULL AND EDSH_CABLE_ENDDATE IS NOT NULL) THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EDSH_CABLE_STARTDATE SHOULD NOT BE NULL';
		END IF;
		IF(EDSH_CABLE_ENDDATE IS NULL AND EDSH_CABLE_STARTDATE IS NOT NULL) THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EDSH_CABLE_ENDDATE SHOULD NOT BE NULL';
		END IF;
		IF(EDSH_INTERNET_STARTDATE IS NULL AND EDSH_INTERNET_ENDDATE IS NOT NULL) THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EDSH_INTERNET_STARTDATE SHOULD NOT BE NULL';
		END IF;
		IF(EDSH_INTERNET_ENDDATE IS NULL AND EDSH_INTERNET_STARTDATE IS NOT NULL) THEN
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT='EDSH_INTERNET_ENDDATE SHOULD NOT BE NULL';
		END IF;
		IF(EDSH_CABLE_STARTDATE IS NOT NULL)THEN
			IF EDSH_CABLE_STARTDATE NOT BETWEEN MINDATE AND MAXDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT=' EDSH_CABLE_START_DATE SHOULD BETWEEN UNIT STARDATE AND ENDDATE';
			END IF;
		END IF;
		IF(EDSH_CABLE_ENDDATE IS NOT NULL)THEN
			IF EDSH_CABLE_ENDDATE NOT BETWEEN MINDATE AND UNITENDDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT=' EDSH_CABLE_ENDDATE SHOULD BETWEEN UNIT STARDATE AND UNIT ENDDATE';
			END IF;
		END IF;
		IF(EDSH_INTERNET_STARTDATE IS NOT NULL)THEN
			IF EDSH_INTERNET_STARTDATE NOT BETWEEN MINDATE AND MAXDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EDSH_INTERNET_START_DATE SHOULD BETWEEN UNIT STARDATE  AND UNIT ENDDATE';
			END IF;
		END IF;
		IF(EDSH_INTERNET_ENDDATE IS NOT NULL)THEN	
			IF EDSH_INTERNET_ENDDATE NOT BETWEEN MINDATE AND UNITENDDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EDSH_INTERNET_ENDDATE SHOULD BETWEEN UNIT STARDATE  AND UNIT ENDDATE';
			END IF;
		END IF;
		IF(EDSH_CABLE_STARTDATE IS NOT NULL AND EDSH_CABLE_ENDDATE IS NOT NULL)THEN
			IF EDSH_CABLE_ENDDATE < EDSH_CABLE_STARTDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EDSH_CABLE_END_DATE SHOULD BE GREATER THEN OR EQUAL TO EDSH_CABLE_STARTDATE';
			END IF;
		END IF;
		IF(EDSH_INTERNET_STARTDATE IS NOT NULL AND EDSH_INTERNET_ENDDATE IS NOT NULL)THEN
			IF EDSH_INTERNET_ENDDATE < EDSH_INTERNET_STARTDATE THEN
				SIGNAL SQLSTATE '45000'
				SET MESSAGE_TEXT='EDSH_INTERNET_END_DATE SHOULD BE GREATER THEN OR EQUAL TO EDSH_INTERNET_START_DATE';
			END IF;
		END IF;
	END IF;
END;