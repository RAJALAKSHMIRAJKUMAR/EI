DROP PROCEDURE IF EXISTS SP_SUBPERSONAL_INSERT;
CREATE PROCEDURE SP_SUBPERSONAL_INSERT(
IN INPUT_ECNID TEXT,
IN INPUT_INVOICEDATE DATE,
IN INPUT_AMOUNT DECIMAL(7,2),
IN INPUT_INVOICEITEMS TEXT,
IN INPUT_INVOICEFROM VARCHAR(200),
IN INPUT_COMMENTS TEXT,
IN INPUT_USERSTAMP VARCHAR(50),
OUT SUCCESSFLAG INTEGER)
BEGIN
    DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		SET SUCCESSFLAG = 0;
		ROLLBACK; 
	END;
	IF(INPUT_ECNID='' OR INPUT_ECNID IS NULL)THEN
		SET INPUT_ECNID = NULL;
	END IF;
	IF(INPUT_INVOICEDATE='' OR INPUT_INVOICEDATE IS NULL)THEN
		SET INPUT_INVOICEDATE = NULL;
	END IF;
	IF(INPUT_AMOUNT='' OR INPUT_AMOUNT IS NULL)THEN
		SET INPUT_AMOUNT = NULL;
	END IF;
	IF(INPUT_INVOICEITEMS='' OR INPUT_INVOICEITEMS IS NULL)THEN
		SET INPUT_INVOICEITEMS = NULL;
	END IF;
	IF(INPUT_INVOICEFROM='' OR INPUT_INVOICEFROM IS NULL)THEN
		SET INPUT_INVOICEFROM = NULL;
	END IF;
	IF(INPUT_COMMENTS='' OR INPUT_COMMENTS IS NULL)THEN
		SET INPUT_COMMENTS = NULL;
	END IF;
	IF(INPUT_USERSTAMP='' OR INPUT_USERSTAMP IS NULL)THEN
		SET INPUT_USERSTAMP = NULL;
	END IF;
	START TRANSACTION;	
	SET SUCCESSFLAG = 0;
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(INPUT_USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	IF(INPUT_ECNID IS NOT NULL AND INPUT_INVOICEDATE IS NOT NULL AND INPUT_AMOUNT IS NOT NULL AND INPUT_INVOICEITEMS IS NOT NULL AND INPUT_INVOICEFROM IS NOT NULL  AND INPUT_USERSTAMP IS NOT NULL)THEN
		INSERT INTO EXPENSE_PERSONAL (ECN_ID,EP_INVOICE_DATE,EP_AMOUNT,EP_INVOICE_ITEMS,EP_INVOICE_FROM,EP_COMMENTS,ULD_ID) VALUES 
		(INPUT_ECNID,INPUT_INVOICEDATE,INPUT_AMOUNT,INPUT_INVOICEITEMS,INPUT_INVOICEFROM,INPUT_COMMENTS,USERSTAMP_ID);
		SET SUCCESSFLAG = 1;
	END IF;
COMMIT;
END;