DROP PROCEDURE IF EXISTS SP_BIZDLY_SUBUNIT_INSERT;
CREATE PROCEDURE SP_BIZDLY_SUBUNIT_INSERT(
IN EUUNITNO TEXT,
IN EUECNID TEXT,
IN EUCUSTOMERID TEXT,
IN EUINVOICEDATE DATE,
IN EUAMOUNT DECIMAL(7,2),
IN EUINVOICEITEM TEXT,
IN EUINVOICEFROM VARCHAR(200),
IN EUCOMMENTS TEXT,
IN USERSTAMP VARCHAR(50),
OUT SUCCESS_FLAG INTEGER)
BEGIN
    DECLARE USERSTAMP_ID INTEGER(2);
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        SET SUCCESS_FLAG = 0;
        ROLLBACK;
    END;
    CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
    SET USERSTAMP_ID = (SELECT @ULDID);
    IF(EUUNITNO='' OR EUUNITNO IS NULL)THEN
        SET EUUNITNO = NULL;
    END IF;
  IF (EUECNID='' OR EUECNID IS NULL)THEN
        SET EUECNID=NULL;
  END IF;
  IF(EUCUSTOMERID='' OR EUCUSTOMERID IS NULL)THEN
        SET EUCUSTOMERID = NULL;
    END IF;
    IF(EUINVOICEDATE='' OR EUINVOICEDATE IS NULL)THEN
        SET EUINVOICEDATE = NULL;
    END IF;
    IF(EUAMOUNT='' OR EUAMOUNT IS NULL)THEN
        SET EUAMOUNT = NULL;
    END IF;
    IF(EUINVOICEITEM='' OR EUINVOICEITEM IS NULL)THEN
        SET EUINVOICEITEM = NULL;
    END IF;
    IF(EUINVOICEFROM='' OR EUINVOICEFROM IS NULL)THEN
        SET EUINVOICEFROM = NULL;
    END IF;
    IF(EUCOMMENTS='' OR EUCOMMENTS IS NULL)THEN
        SET EUCOMMENTS = NULL;
    END IF;
    IF(USERSTAMP='' OR USERSTAMP IS NULL)THEN
        SET USERSTAMP = NULL;
    END IF;
    START TRANSACTION;   
  SET SUCCESS_FLAG = 0;
    IF(EUUNITNO IS NOT NULL AND EUECNID IS NOT NULL AND EUINVOICEDATE IS NOT NULL AND EUAMOUNT IS NOT NULL AND EUINVOICEITEM IS NOT NULL AND EUINVOICEFROM IS NOT NULL AND USERSTAMP IS NOT NULL)THEN
          IF((EUECNID='23' AND EUCUSTOMERID IS NOT NULL) OR (EUECNID='24' AND EUCUSTOMERID IS NULL) OR(EUECNID='22' AND EUCUSTOMERID IS NULL))  THEN
            INSERT INTO EXPENSE_UNIT (UNIT_ID,ECN_ID,CUSTOMER_ID,EU_INVOICE_DATE,EU_AMOUNT,EU_INVOICE_ITEMS,
            EU_INVOICE_FROM,EU_COMMENTS,ULD_ID)VALUES((SELECT UNIT_ID FROM UNIT WHERE UNIT_NO=EUUNITNO),EUECNID,
            EUCUSTOMERID,EUINVOICEDATE,EUAMOUNT,EUINVOICEITEM,EUINVOICEFROM,EUCOMMENTS,USERSTAMP_ID);
            SET SUCCESS_FLAG = 1;
          END IF;
    END IF;
COMMIT;
END;