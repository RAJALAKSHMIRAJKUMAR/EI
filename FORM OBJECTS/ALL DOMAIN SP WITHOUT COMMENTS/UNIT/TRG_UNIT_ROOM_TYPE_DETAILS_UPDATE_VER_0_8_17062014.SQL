DROP TRIGGER IF EXISTS TRG_UNIT_ROOM_TYPE_DETAILS_UPDATE;
CREATE TRIGGER TRG_UNIT_ROOM_TYPE_DETAILS_UPDATE
AFTER UPDATE ON UNIT_ROOM_TYPE_DETAILS
FOR EACH ROW
BEGIN 
	DECLARE OLD_VALUE TEXT DEFAULT '';
	DECLARE NEW_VALUE TEXT DEFAULT '';
	IF (OLD.URTD_ROOM_TYPE!= NEW.URTD_ROOM_TYPE) THEN 
		IF (OLD.URTD_ID) THEN  
		  SET OLD_VALUE = CONCAT(OLD_VALUE,'URTD_ID=', OLD.URTD_ID,','); 
		END IF;
	END IF;
	IF (OLD.URTD_ROOM_TYPE!= NEW.URTD_ROOM_TYPE) THEN  
		SET OLD_VALUE = CONCAT(OLD_VALUE,'URTD_ROOM_TYPE=', OLD.URTD_ROOM_TYPE,','); 
	END IF;
	IF (OLD.URTD_ROOM_TYPE!= NEW.URTD_ROOM_TYPE) THEN  
		SET NEW_VALUE = CONCAT(NEW_VALUE,'URTD_ROOM_TYPE=', NEW.URTD_ROOM_TYPE,','); 
	END IF;
	IF (OLD.URTD_ROOM_TYPE!= NEW.URTD_ROOM_TYPE) THEN 
		IF (OLD.ULD_ID!= NEW.ULD_ID) THEN  
			SET OLD_VALUE = CONCAT(OLD_VALUE,'ULD_ID=', OLD.ULD_ID,','); 
		END IF;
		IF (OLD.URTD_TIMESTAMP!= NEW.URTD_TIMESTAMP) THEN 	 
			SET OLD_VALUE = CONCAT(OLD_VALUE,'URTD_TIMESTAMP=', OLD.URTD_TIMESTAMP,','); 
		END IF;
	END IF;
	IF (OLD_VALUE!='' AND NEW_VALUE!='') THEN
		IF(OLD_VALUE!=NEW_VALUE)THEN
			SET OLD_VALUE = SUBSTRING(OLD_VALUE,1,CHAR_LENGTH(OLD_VALUE)-1);
			SET NEW_VALUE = SUBSTRING(NEW_VALUE,1,CHAR_LENGTH(NEW_VALUE)-1);
			INSERT INTO TICKLER_HISTORY
			(ULD_ID,TP_ID,TTIP_ID,TH_OLD_VALUE,TH_NEW_VALUE)VALUES
			((SELECT ULD_ID FROM UNIT_ROOM_TYPE_DETAILS  WHERE URTD_ID=NEW.URTD_ID),
			(SELECT TP_ID FROM TICKLER_PROFILE WHERE TP_TYPE='UPDATION'),
			(SELECT TTIP_ID FROM TICKLER_TABID_PROFILE WHERE TTIP_DATA='UNIT_ROOM_TYPE_DETAILS'),OLD_VALUE,NEW_VALUE);
		END IF;
	END IF;
END;