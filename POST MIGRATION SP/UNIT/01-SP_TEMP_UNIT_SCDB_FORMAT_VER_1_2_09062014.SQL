DROP PROCEDURE IF EXISTS SP_TEMP_UNIT_SCDB_FORMAT;
CREATE PROCEDURE SP_TEMP_UNIT_SCDB_FORMAT(IN SOURCESCHEMA VARCHAR(50),IN DESTINATIONSCHEMA VARCHAR(50))
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN 
ROLLBACK;
END;
START TRANSACTION;
	SET @TEMP_UNITSCDB_DROPQUERY=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT'));
	PREPARE TEMP_UNITSCDB_DROPSTMT FROM @TEMP_UNITSCDB_DROPQUERY;
	EXECUTE TEMP_UNITSCDB_DROPSTMT;
	SET @TEMP_UNITSCDB_CREATEQUERY=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT(
    LIKE ',SOURCESCHEMA,'.UNIT_SCDB_FORMAT)'));
	PREPARE TEMP_UNITSCDB_CREATESTMT FROM @TEMP_UNITSCDB_CREATEQUERY;
	EXECUTE TEMP_UNITSCDB_CREATESTMT;
	SET @TEMP_UNITSCDB_INSERTQUERY=(SELECT CONCAT('INSERT INTO ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT SELECT * FROM ',SOURCESCHEMA,'.UNIT_SCDB_FORMAT'));
	PREPARE TEMP_UNIT_SCDB_INSERTSTMT FROM @TEMP_UNITSCDB_INSERTQUERY;
	EXECUTE TEMP_UNIT_SCDB_INSERTSTMT;
	SET @UPDATEStudio1=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT SET UNIT_ROOM_TYPE=',"'Studio1'",' WHERE UNIT_ROOM_TYPE=',"'STUDIO 1'"));
	PREPARE UPDATEStudio1STMT FROM @UPDATEStudio1;
	EXECUTE UPDATEStudio1STMT;
	SET @UPDATEStudio2=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT SET UNIT_ROOM_TYPE=',"'Studio2'",' WHERE UNIT_ROOM_TYPE=',"'STUDIO 2'"));
	PREPARE UPDATEStudio2STMT FROM @UPDATEStudio2;
	EXECUTE UPDATEStudio2STMT;
	SET @UPDATETIMESTAMP=(SELECT CONCAT('UPDATE ',DESTINATIONSCHEMA,'.TEMP_UNIT_SCDB_FORMAT SET TIMESTAMP=(SELECT CONVERT_TZ(TIMESTAMP, "+08:00","+0:00"))'));
PREPARE UPDATETIMESTAMPSTMT FROM @UPDATETIMESTAMP;
EXECUTE UPDATETIMESTAMPSTMT;
COMMIT;
END; 
