DROP PROCEDURE IF EXISTS SP_BANK_TRANSFER_DETAIL_TABLE;
CREATE PROCEDURE SP_BANK_TRANSFER_DETAIL_TABLE(IN SOURCESCHEMA VARCHAR(50),IN DESTINATIONSCHEMA VARCHAR(50),IN MIGUSERSTAMP VARCHAR(50))
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN 
ROLLBACK;
END;
START TRANSACTION;
SET FOREIGN_KEY_CHECKS=0;
	SET @DROP_BANK_TRANSFER_DETAIL=(SELECT CONCAT('DROP TABLE IF EXISTS ',DESTINATIONSCHEMA,'.BANK_TRANSFER_DETAIL'));
	PREPARE DBANKTRANSFERDETAIL FROM @DROP_BANK_TRANSFER_DETAIL;
    EXECUTE DBANKTRANSFERDETAIL;
	SET @CREATE_BANK_TRANSFER_DETAIL=(SELECT CONCAT('CREATE TABLE ',DESTINATIONSCHEMA,'.BANK_TRANSFER_DETAIL( BTD_ID	INTEGER NOT NULL AUTO_INCREMENT,UNIT_ID	INTEGER NOT NULL,CUSTOMER_ID	INTEGER NOT NULL,BT_ID INTEGER NOT NULL,PRIMARY KEY(BTD_ID),FOREIGN KEY(UNIT_ID) REFERENCES ',DESTINATIONSCHEMA,'.UNIT (UNIT_ID),FOREIGN KEY(CUSTOMER_ID) REFERENCES ',DESTINATIONSCHEMA,'.CUSTOMER (CUSTOMER_ID),FOREIGN KEY(BT_ID) REFERENCES ',DESTINATIONSCHEMA,'.BANK_TRANSFER (BT_ID))'));
    PREPARE CBANKTRANSFERDETAIL FROM @CREATE_BANK_TRANSFER_DETAIL;
    EXECUTE CBANKTRANSFERDETAIL;
SET FOREIGN_KEY_CHECKS=1;
COMMIT;
END;
