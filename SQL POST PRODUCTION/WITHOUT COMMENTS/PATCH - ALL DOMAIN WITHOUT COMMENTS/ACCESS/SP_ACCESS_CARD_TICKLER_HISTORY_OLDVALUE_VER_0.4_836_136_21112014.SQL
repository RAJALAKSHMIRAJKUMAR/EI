DROP PROCEDURE IF EXISTS SP_ACCESS_CARD_TICKLER_HISTORY_OLDVALUE;
CREATE PROCEDURE SP_ACCESS_CARD_TICKLER_HISTORY_OLDVALUE (
IN CUSTOMERID INTEGER,
IN CACDID INTEGER,
IN USERSTAMP VARCHAR(50),
OUT OLDVALUE_ACCESS TEXT,
OUT OLDUASDID INTEGER)
BEGIN
	DECLARE NEWULDID INTEGER;
	SET OLDVALUE_ACCESS='';
	SET NEWULDID = (SELECT ULD_ID FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP);
	SET OLDUASDID = (SELECT UASD_ID FROM CUSTOMER_ACCESS_CARD_DETAILS WHERE CUSTOMER_ID = CUSTOMERID AND CACD_ID = CACDID);
	SET OLDVALUE_ACCESS = (SELECT CONCAT (OLDVALUE_ACCESS,'CACD_ID = ',CACDID,',CUSTOMER_ID=',CUSTOMERID,',UASD_ID=',OLDUASDID));
	SET OLDVALUE_ACCESS = (SELECT CONCAT (OLDVALUE_ACCESS));
END;
