DROP PROCEDURE IF EXISTS SP_CHEQUE_INSERT;
CREATE PROCEDURE SP_CHEQUE_INSERT(
IN CHEQUEDATE DATE,
IN CHEQUETO VARCHAR(100),
IN CHEQUENO INTEGER(6),
IN CHEQUEFOR VARCHAR(100),
IN CHEQUEAMOUNT DECIMAL(7,2),
IN CHEQUEUNITNO VARCHAR(25),
IN CHEQUECOMMENTS TEXT,
IN USERSTAMP VARCHAR(50),
OUT CHEQUEFLAG INTEGER(10))
BEGIN
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK;
		SET CHEQUEFLAG=0;
	END;
	SET CHEQUEFLAG=0;
	SET AUTOCOMMIT = 0;
	START TRANSACTION;
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	IF(CHEQUEDATE IS NOT NULL AND CHEQUETO IS NOT NULL AND CHEQUENO IS NOT NULL AND CHEQUEFOR IS NOT NULL AND CHEQUEAMOUNT IS NOT NULL AND USERSTAMP IS NOT NULL)THEN
		INSERT INTO CHEQUE_ENTRY_DETAILS(CHEQUE_DATE,CHEQUE_TO,CHEQUE_NO,CHEQUE_FOR,CHEQUE_AMOUNT,CHEQUE_UNIT_NO,
		BCN_ID,CHEQUE_COMMENTS,ULD_ID)VALUES(CHEQUEDATE,CHEQUETO,CHEQUENO,CHEQUEFOR,CHEQUEAMOUNT,CHEQUEUNITNO,
		12,CHEQUECOMMENTS,USERSTAMP_ID);
		SET CHEQUEFLAG=1;
	END IF;
COMMIT;
END;
