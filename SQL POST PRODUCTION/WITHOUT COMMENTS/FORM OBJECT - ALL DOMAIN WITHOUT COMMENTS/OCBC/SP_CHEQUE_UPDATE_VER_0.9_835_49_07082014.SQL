DROP PROCEDURE IF EXISTS SP_CHEQUE_UPDATE;
CREATE PROCEDURE SP_CHEQUE_UPDATE(
IN CHEQUEID INTEGER,
IN CSDATA VARCHAR(15),
IN CHEQUEDATE DATE,
IN CHEQUETO VARCHAR(100),
IN CHEQUENO INTEGER(6),
IN CHEQUEFOR VARCHAR(100),
IN CHEQUEAMOUNT DECIMAL(7,2),
IN CHEQUEUNITNO VARCHAR(25),
IN DEBITEDRETURNEDDATE DATE,
IN CHEQUECOMMENTS TEXT,
IN USERSTAMP VARCHAR(40),
OUT CHEQUEFLAG INTEGER(10))
BEGIN
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK;
		SET CHEQUEFLAG=0;
	END;
	SET CHEQUEFLAG=0;
	SET AUTOCOMMIT = 0;
	START TRANSACTION;
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	UPDATE CHEQUE_ENTRY_DETAILS SET BCN_ID=(SELECT BCN_ID FROM BANKTT_CONFIGURATION WHERE BCN_DATA=CSDATA),
	CHEQUE_DATE=CHEQUEDATE,CHEQUE_TO=CHEQUETO,CHEQUE_NO=CHEQUENO,CHEQUE_FOR=CHEQUEFOR,
	CHEQUE_AMOUNT=CHEQUEAMOUNT,CHEQUE_UNIT_NO=CHEQUEUNITNO,CHEQUE_DEBITED_RETURNED_DATE=DEBITEDRETURNEDDATE,
	CHEQUE_COMMENTS=CHEQUECOMMENTS,ULD_ID=USERSTAMP_ID WHERE CHEQUE_ID=CHEQUEID;
	SET CHEQUEFLAG=1;
	COMMIT;
END;
