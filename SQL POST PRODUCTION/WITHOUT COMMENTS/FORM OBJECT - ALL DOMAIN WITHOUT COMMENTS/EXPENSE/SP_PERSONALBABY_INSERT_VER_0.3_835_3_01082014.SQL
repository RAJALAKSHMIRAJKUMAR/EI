DROP PROCEDURE IF EXISTS SP_PERSONALBABY_INSERT;
CREATE PROCEDURE SP_PERSONALBABY_INSERT(
IN ECNID TEXT,
IN INVOICEDATE TEXT,
IN AMOUNT TEXT,
IN INVOICEITEMS TEXT,
IN INVOICEFROM TEXT,
IN COMMENTS TEXT,
IN USERSTAMP VARCHAR(50),
OUT FINALMESSAGE TEXT)
BEGIN
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EBECNID TEXT;
	DECLARE EBINVOICEDATE DATE;
	DECLARE EBAMOUNT  DECIMAL(7,2);
	DECLARE EBINVOICEITEMS TEXT;
	DECLARE EBINVOICEFROM VARCHAR(200);
	DECLARE EBCOMMENTS TEXT;
	DECLARE SUBSPSUCCESSFLAG INTEGER;
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK; 
	END;
	SET @TEMP_ECNID = ECNID;
	SET @TEMP_INVOICEDATE = INVOICEDATE;
	SET @TEMP_AMOUNT = AMOUNT;
	SET @TEMP_INVOICEITEMS = INVOICEITEMS;
	SET @TEMP_INVOICEFROM = INVOICEFROM;
	SET @TEMP_COMMENTS = COMMENTS;
	SET FINALMESSAGE = '';
		MAIN_LOOP : LOOP
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TEMP_ECNID,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBECNID;
		SELECT @REMAINING_STRING INTO @TEMP_ECNID;
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TEMP_INVOICEDATE,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBINVOICEDATE;
		SELECT @REMAINING_STRING INTO @TEMP_INVOICEDATE;
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES(',',@TEMP_AMOUNT,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBAMOUNT;
		SELECT @REMAINING_STRING INTO @TEMP_AMOUNT;
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('^^',@TEMP_INVOICEITEMS,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBINVOICEITEMS;
		SELECT @REMAINING_STRING INTO @TEMP_INVOICEITEMS;
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('^^',@TEMP_INVOICEFROM,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBINVOICEFROM;
		SELECT @REMAINING_STRING INTO @TEMP_INVOICEFROM;
		CALL SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES('^^',@TEMP_COMMENTS,@VALUE,@REMAINING_STRING);
		SELECT @VALUE INTO EBCOMMENTS;
		SELECT @REMAINING_STRING INTO @TEMP_COMMENTS;	
		SET AUTOCOMMIT = 0;
		START TRANSACTION;	
		IF(EBECNID IS NOT NULL AND EBINVOICEDATE IS NOT NULL AND EBAMOUNT IS NOT NULL AND EBINVOICEITEMS IS NOT NULL AND EBINVOICEFROM IS NOT NULL  AND USERSTAMP IS NOT NULL)THEN 
			CALL SP_SUBPERSONAL_BABY_INSERT(EBECNID,EBINVOICEDATE,EBAMOUNT,EBINVOICEITEMS,EBINVOICEFROM,EBCOMMENTS,USERSTAMP,@SUCCESSFLAG);
			SET SUBSPSUCCESSFLAG = (SELECT @SUCCESSFLAG);
		END IF;
		IF(SUBSPSUCCESSFLAG=0)THEN
			SET FINALMESSAGE = (SELECT CONCAT(FINALMESSAGE,' ','ECN_DATA=',EBECNID,',','INVOICE_DATE=',EBINVOICEDATE,',',
			'AMOUNT=',EBAMOUNT,',','INVOICE_ITEMS=',EBINVOICEITEMS,',','INVOICE_FROM=',EBINVOICEFROM,',',
			'COMMENTS=',EBCOMMENTS,',','USERSTAMP=',USERSTAMP));
		END IF;
		IF @TEMP_ECNID IS NULL THEN
			LEAVE  MAIN_LOOP;
		END IF;
	END LOOP;
	IF(FINALMESSAGE = '')THEN
		SET FINALMESSAGE = 1;
	END IF;
COMMIT;
END;
