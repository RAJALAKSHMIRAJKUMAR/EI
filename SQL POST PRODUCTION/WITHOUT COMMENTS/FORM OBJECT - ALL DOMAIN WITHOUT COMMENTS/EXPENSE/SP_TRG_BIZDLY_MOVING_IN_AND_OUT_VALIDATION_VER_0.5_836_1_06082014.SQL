DROP PROCEDURE IF EXISTS SP_TRG_BIZDLY_MOVING_IN_AND_OUT_VALIDATION;
CREATE PROCEDURE SP_TRG_BIZDLY_MOVING_IN_AND_OUT_VALIDATION(
IN NEWUNITID INTEGER,
IN NEWINVOICEDATE DATE,
IN PROCESS TEXT)
BEGIN
  DECLARE UNITSTARTDATE DATE;
  DECLARE UNITENDDATE DATE;
  DECLARE CONFIGENDDATE DATE;
  DECLARE MESSAGE_TEXT VARCHAR(50);
  DECLARE ERRORMSG TEXT;
  DECLARE EMIOAMT INTEGER;
  DECLARE MSG TEXT;
CALL SP_CONFIG_SDATE_EDATE(NEWUNITID,@S_CONFIGDATE,@E_CONFIGDATE,@INVOICE_DATE);  
SET UNITSTARTDATE=@S_CONFIGDATE;
  SET CONFIGENDDATE=@E_CONFIGDATE;
  SET UNITENDDATE=@INVOICE_DATE;
    IF(PROCESS = 'INSERT') OR (PROCESS='UPDATE')THEN  
		IF (NEWINVOICEDATE > CURDATE())THEN
    SET ERRORMSG=(SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=474);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERRORMSG;
		END IF;
		IF(NEWINVOICEDATE NOT BETWEEN UNITSTARTDATE AND UNITENDDATE)THEN
     SET ERRORMSG=(SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=475);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERRORMSG;
		END IF;
        END IF;
END;
