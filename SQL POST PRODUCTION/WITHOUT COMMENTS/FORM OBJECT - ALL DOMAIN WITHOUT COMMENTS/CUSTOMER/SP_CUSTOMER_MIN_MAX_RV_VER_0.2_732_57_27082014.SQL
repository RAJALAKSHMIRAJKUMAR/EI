DROP PROCEDURE IF EXISTS SP_CUSTOMER_MIN_MAX_RV;
CREATE PROCEDURE SP_CUSTOMER_MIN_MAX_RV(CUSTID INTEGER,OUT MIN_LP INTEGER,OUT MAX_LP INTEGER)
BEGIN
DECLARE MIN_CUSTRV INTEGER;
DECLARE TNAME TEXT;
	SET MIN_CUSTRV=(SELECT MAX(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE CED_RECHECKIN IS NOT NULL AND  IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);
	SET MIN_LP=MIN_CUSTRV;
	SET MAX_LP=(SELECT MAX(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);
	IF MIN_CUSTRV IS NULL THEN
		SET MIN_LP=(SELECT MIN(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);		
	END IF;	
END;
