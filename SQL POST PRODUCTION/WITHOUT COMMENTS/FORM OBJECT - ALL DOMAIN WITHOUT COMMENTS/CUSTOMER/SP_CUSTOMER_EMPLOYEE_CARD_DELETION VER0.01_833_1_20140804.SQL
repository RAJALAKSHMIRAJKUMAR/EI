DROP PROCEDURE IF EXISTS SP_CUSTOMER_EMPLOYEE_CARD_DELETION;
CREATE PROCEDURE SP_CUSTOMER_EMPLOYEE_CARD_DELETION(IN TABLE_ID INT, IN ROW_ID INT,IN V_USERSTAMP INT(2))
BEGIN
DECLARE EMPID INT;
DECLARE UASDID INT;
DECLARE DEL_EMP_CARD_DETAILS TEXT;
SET EMPID=(SELECT EMP_ID FROM EMPLOYEE_CARD_DETAILS WHERE ECD_ID=ROW_ID);
SET UASDID=(SELECT UASD_ID FROM EMPLOYEE_CARD_DETAILS WHERE ECD_ID=ROW_ID);
SET DEL_EMP_CARD_DETAILS=(CONCAT('ECD_ID=',ROW_ID,',EMP_ID=',EMPID,',UASD_ID=',UASDID));
DELETE FROM EMPLOYEE_CARD_DETAILS WHERE ECD_ID=ROW_ID;
INSERT INTO TICKLER_HISTORY (TP_ID, TTIP_ID, TH_OLD_VALUE, ULD_ID)VALUES (2, TABLE_ID, DEL_EMP_CARD_DETAILS, V_USERSTAMP);
END;
