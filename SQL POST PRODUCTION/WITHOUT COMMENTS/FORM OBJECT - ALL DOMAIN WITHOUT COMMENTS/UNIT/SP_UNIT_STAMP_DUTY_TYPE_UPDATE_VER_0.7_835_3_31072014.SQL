DROP PROCEDURE IF EXISTS SP_UNIT_STAMP_DUTY_TYPE_UPDATE;
CREATE PROCEDURE SP_UNIT_STAMP_DUTY_TYPE_UPDATE(
IN ID INT,
IN STAMP_DUTY_TYPE VARCHAR(30),
IN USERSTAMP VARCHAR(50),
OUT FLAG INTEGER)
BEGIN 
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK; 
		SET FLAG = 0;
	END;
	SET AUTOCOMMIT = 0;
	START TRANSACTION;
	SET FLAG = 0;
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	IF NOT EXISTS(SELECT USDT_DATA FROM UNIT_STAMP_DUTY_TYPE WHERE USDT_DATA=STAMP_DUTY_TYPE)THEN
		UPDATE UNIT_STAMP_DUTY_TYPE SET USDT_DATA=STAMP_DUTY_TYPE,ULD_ID=USERSTAMP_ID WHERE USDT_ID = ID;
		SET FLAG = 1;
	END IF;
	COMMIT;
END;
