

DROP PROCEDURE IF EXISTS SP_AUTO_INCREMENT_ID_MISSING_TABLES;
CREATE PROCEDURE SP_AUTO_INCREMENT_ID_MISSING_TABLES()
BEGIN
DECLARE MINID INTEGER;
DECLARE MAXID INTEGER;
DECLARE TABLENAME TEXT;
DECLARE TABLEMINID INTEGER;
DECLARE TABLEMAXID INTEGER;
DECLARE PRIMARY_KEY_COLUMN TEXT;
DECLARE PRIMARY_ID INTEGER;
DECLARE MISSINGID TEXT;

DROP TABLE IF EXISTS TEMP_AUTO_INCREMENT_MISSING_TABLES;
CREATE TABLE TEMP_AUTO_INCREMENT_MISSING_TABLES(ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,TABLE_NAME TEXT,MISSING_AUTO_INCREMENTID TEXT);

INSERT INTO TEMP_AUTO_INCREMENT_MISSING_TABLES(TABLE_NAME) SELECT TTIP_DATA FROM TICKLER_TABID_PROFILE WHERE TTIP_ID NOT IN(68,69,94,95);

SET MINID=(SELECT MIN(ID) FROM TEMP_AUTO_INCREMENT_MISSING_TABLES);
SET MAXID=(SELECT MAX(ID) FROM TEMP_AUTO_INCREMENT_MISSING_TABLES);


WHILE MINID<=MAXID DO
SET @COUNT=MINID;
	
	SET TABLENAME=(SELECT TRIM(TABLE_NAME) FROM TEMP_AUTO_INCREMENT_MISSING_TABLES WHERE ID=MINID);
	SET PRIMARY_KEY_COLUMN=(SELECT DISTINCT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME=TABLENAME AND COLUMN_KEY='PRI' AND TABLE_SCHEMA=(SELECT DATABASE()));
	SET MISSINGID=" ";
	SET  @PRI_COLUMN=PRIMARY_KEY_COLUMN;
	SET  @PRI_TABLE_NAME=TABLENAME;
	
	SET TABLEMINID= 1;
		
	SET @SETMAXID=(SELECT CONCAT('SELECT COUNT(*) INTO @COUNTMAXID FROM ',TABLENAME));
	PREPARE SETMAXIDSTMT FROM @SETMAXID;
	EXECUTE SETMAXIDSTMT;
	DEALLOCATE PREPARE SETMAXIDSTMT;
	SET TABLEMAXID=@COUNTMAXID;
IF TABLENAME IS NOT NULL THEN
IF TABLEMINID IS NOT NULL AND TABLEMAXID IS NOT NULL THEN
	WHILE TABLEMINID<=TABLEMAXID DO
	SET @FLAG=1;
		SET @CHECK_PRIMARY_ID=(SELECT CONCAT('SELECT ',PRIMARY_KEY_COLUMN,' INTO @PRIID FROM ',TABLENAME,' WHERE ',PRIMARY_KEY_COLUMN,'=',TABLEMINID));
		PREPARE CHECK_PRIMARY_ID_STMT FROM @CHECK_PRIMARY_ID;
		EXECUTE CHECK_PRIMARY_ID_STMT;

		SET PRIMARY_ID=@PRIID;

		IF PRIMARY_ID IS NULL THEN

		SET MISSINGID=(SELECT CONCAT(MISSINGID,',',TABLEMINID));

		END IF;
		SET @FLAG=2;
		SET  @PRIID=NULL;
		SET TABLEMINID=TABLEMINID+1;
	END WHILE;
END IF;
END IF;
	IF MISSINGID=" " THEN
	SET MISSINGID='{null}';
	END IF;
	IF MISSINGID!='{null}' then
	SET MISSINGID=(SELECT SUBSTRING(MISSINGID,3));
	END IF;
	SET @FLAG=3;
	SET @UPDATE_TABLE_MISSING_ID=(SELECT CONCAT('UPDATE TEMP_AUTO_INCREMENT_MISSING_TABLES  SET MISSING_AUTO_INCREMENTID=','"',MISSINGID,'"',' WHERE ID=',MINID));
	PREPARE UPDATE_TABLE_MISSING_ID_STMT FROM @UPDATE_TABLE_MISSING_ID;
	EXECUTE UPDATE_TABLE_MISSING_ID_STMT;
	DEALLOCATE PREPARE UPDATE_TABLE_MISSING_ID_STMT;

	SET MISSINGID=" " ;

SET MINID=MINID+1;
END WHILE;
SELECT * FROM TEMP_AUTO_INCREMENT_MISSING_TABLES;
END;
