-->version 0.7 -->start date:13/08/2014 end date:13/08/2014 -->issueno:836--commentno:#32 --> DESC:changing amt data type(7,2) as DECIMAL(5,2) DONE BY: RL
-->version 0.6 -->start date:01/08/2014 end date:01/08/2014 -->issueno:831--commentno:#1 --> DESC:autocommit DONE BY: dhivya
-->version 0.5 -->start date:28/02/2014 end date:28/02/2014 -->issueno:754 --commentno:#36 --> DESC:CHANGING THE DATATYPE AND THE VALUE OF USERSTAMP DONE BY: BHAVANI.R
-->version 0.4 -->start date:27/02/2014 end date:27/02/2014 -->issueno:754  --> repalce userstamp varchar to integer-->by: BALAJI.R
-->version 0.3 -->start date:26/02/2014 end date:26/02/2014 -->issueno:750  -->description:UPDATING USERSTAMP TO ULD_ID -->created by:SAFI.M
-->version 0.2 -->start date:18/02/2014 end date:18/02/2014 -->issueno:749 commentno:#33 -->description:implement flag for success message  -->created by:ABDUL KADER.M
--version 0.1 --startdate:09/11/2013 --endate:11/11/2013 --desc:SP FOR EXPENSE_HOUSEKEEPING_PAYMENT_UPDATE --doneby:dinesh

DROP PROCEDURE IF EXISTS SP_BIZDLY_HOUSEKEEPING_PAYMENT_UPDATE;
CREATE PROCEDURE SP_BIZDLY_HOUSEKEEPING_PAYMENT_UPDATE(
IN ID INTEGER(10),
IN UNIT_NUMBER SMALLINT(4), 
IN FOR_PERIOD DATE,
IN PAID_DATE DATE,
IN AMOUNT DECIMAL(5,2),
IN COMMENTS TEXT,
IN USERSTAMP VARCHAR(50),
OUT BHP_FLAG INTEGER(10))
BEGIN
	DECLARE USERSTAMP_ID INTEGER(2);
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK;
		SET  BHP_FLAG=0;
	END;
	SET AUTOCOMMIT=0;
	START TRANSACTION;
	SET BHP_FLAG=0;
	CALL SP_CHANGE_USERSTAMP_AS_ULDID(USERSTAMP,@ULDID);
	SET USERSTAMP_ID = (SELECT @ULDID);
	IF COMMENTS = '' THEN
		SET COMMENTS=NULL;
	END IF;
	IF (FOR_PERIOD IS NOT NULL AND PAID_DATE IS NOT NULL AND AMOUNT IS NOT NULL AND USERSTAMP IS NOT NULL) THEN
		UPDATE EXPENSE_HOUSEKEEPING_PAYMENT SET  UNIT_ID =(SELECT UNIT_ID FROM UNIT WHERE UNIT_NO=UNIT_NUMBER),
		EHKU_ID=(SELECT EHKU_ID FROM EXPENSE_HOUSEKEEPING_UNIT WHERE EHKU_UNIT_NO=UNIT_NUMBER),
		EHKP_FOR_PERIOD= FOR_PERIOD,EHKP_PAID_DATE=PAID_DATE,EHKP_AMOUNT=AMOUNT,EHKP_COMMENTS=COMMENTS,ULD_ID=USERSTAMP_ID WHERE EHKP_ID=ID;
	SET BHP_FLAG=1;
	END IF;
COMMIT;
END;