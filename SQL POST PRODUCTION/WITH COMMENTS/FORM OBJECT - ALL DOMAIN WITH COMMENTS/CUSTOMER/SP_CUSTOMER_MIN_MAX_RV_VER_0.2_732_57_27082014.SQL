-- version --> 0.2 startdate -->31/07/2014 enddate --> 31/07/2014,ISSUE:732,comment:57, description --> REMOVED COMMIT N ROLLBACK N REMOVE TEMP TABLE CREATED BY PUNI
-- version --> 0.1 startdate -->26/06/2014 enddate --> 26/06/2014,ISSUE:345, description --> sp to get min n max lp for a customer BY PUNI
DROP PROCEDURE IF EXISTS SP_CUSTOMER_MIN_MAX_RV;
CREATE PROCEDURE SP_CUSTOMER_MIN_MAX_RV(CUSTID INTEGER,OUT MIN_LP INTEGER,OUT MAX_LP INTEGER)
BEGIN
DECLARE MIN_CUSTRV INTEGER;
DECLARE TNAME TEXT;
	SET MIN_CUSTRV=(SELECT MAX(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE CED_RECHECKIN IS NOT NULL AND  IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);
	SET MIN_LP=MIN_CUSTRV;
	SET MAX_LP=(SELECT MAX(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);
	IF MIN_CUSTRV IS NULL THEN
		SET MIN_LP=(SELECT MIN(CED.CED_REC_VER) FROM CUSTOMER_ENTRY_DETAILS CED,CUSTOMER_LP_DETAILS CLP WHERE IF(CLP.CLP_PRETERMINATE_DATE IS NOT NULL,CLP.CLP_STARTDATE< CLP.CLP_PRETERMINATE_DATE,CLP.CLP_STARTDATE< CLP.CLP_ENDDATE) AND CED.CUSTOMER_ID=CUSTID);		
	END IF;	
END;