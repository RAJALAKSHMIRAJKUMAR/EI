-- version:0.4 --sdate:09/08/2014 --edate:09/08/2014 --issue:836 --desc:error msg getting from config db --doneby:RL
-- version 0.3 -- startdate:09/06/2014 -- endate:09/06/2014 --  ADDED ROLLBACK AND COMMIT-- -desc:SP FOR SP_TRG_EMPLOYEE_CARD_DETAILS - comment #12 -doneby:SASIKALA
-- version 0.2 -- startdate:05/12/2013 -- endate:05/12/2013 --  CHANGED ERROR MEESAGE( DECLARE MESSAGE TEXT AND PASSING ERROR MESSAE TO THIS VARIABLE)-- -desc:SP FOR SP_TRG_EMPLOYEE_CARD_DETAILS - comment #21 -doneby:dinesh
-- version 0.1 -- startdate:02/12/2013 -- endate:02/12/2013 -- desc:SP FOR SP_TRG_EMPLOYEE_CARD_DETAILS -- doneby:dinesh
DROP PROCEDURE IF EXISTS SP_TRG_EMPLOYEE_CARD_DETAILS;
CREATE PROCEDURE SP_TRG_EMPLOYEE_CARD_DETAILS( 
IN UASDID INTEGER,
IN CARD VARCHAR(10))
BEGIN
	DECLARE MESSAGE_TEXT VARCHAR(100);
	DECLARE ERROR_MSG TEXT;
	IF(CARD='INSERT') THEN
		IF EXISTS (SELECT UASD_ID FROM EMPLOYEE_CARD_DETAILS WHERE UASD_ID=UASDID) THEN
			SET ERROR_MSG = (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID = 567);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERROR_MSG;
		END IF;
	END IF;
	IF(CARD='UPDATE') THEN
		IF EXISTS (SELECT UASD_ID FROM EMPLOYEE_CARD_DETAILS WHERE UASD_ID=UASDID) THEN
			SET ERROR_MSG = (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID = 568);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERROR_MSG;
		END IF;
	END IF;
 END;