-- VERSION 0.5 STARTDATE:06/08/2014 ENDDATE:06/08/2014 ISSUE NO: 836  DESC:GETTING ERROR MESSSAGE FROM CONFIG TABLE  AND ADDED AMOUNT VALIDATION DONE BY :SASIKALA
-- VERSION 0.4 STARTDATE:14/07/2014 ENDDATE:14/07/2014 ISSUE NO: 593 COMMENT NO: 283 DESC:UPDATED THE VARIABLE UNITID TO NEWUNITID. DONE BY :SAFI
-- VERSION 0.3 STARTDATE:12/07/2014 ENDDATE:12/07/2014 ISSUE NO: 593 COMMENT NO: 283 DESC:IMPLEMENT INVOICE DATE CHANGES. DONE BY :BHAVANI.R
-- VERSION 0.2 STARTDATE:11/07/2014 ENDDATE:11/07/2014 ISSUE NO: 593 DESC:IMPLEMENT CONFIG UNIT STARTDATE ENDDATE. DONE BY :RAJA
-- VERSION 0.1 STARTDATE:26/06/2014 ENDDATE:26/06/2014 ISSUE NO: 593 DESC:THROWING ERROR MSG FOR THE CHECK CONSTRAINS. DONE BY :RAJA
DROP PROCEDURE IF EXISTS SP_TRG_BIZDLY_MOVING_IN_AND_OUT_VALIDATION;
CREATE PROCEDURE SP_TRG_BIZDLY_MOVING_IN_AND_OUT_VALIDATION(
IN NEWUNITID INTEGER,
IN NEWINVOICEDATE DATE,
IN PROCESS TEXT)
BEGIN
  DECLARE UNITSTARTDATE DATE;
  DECLARE UNITENDDATE DATE;
  DECLARE CONFIGENDDATE DATE;
  DECLARE MESSAGE_TEXT VARCHAR(50);
  DECLARE ERRORMSG TEXT;
  DECLARE EMIOAMT INTEGER;
  DECLARE MSG TEXT;
CALL SP_CONFIG_SDATE_EDATE(NEWUNITID,@S_CONFIGDATE,@E_CONFIGDATE,@INVOICE_DATE);  
SET UNITSTARTDATE=@S_CONFIGDATE;
  SET CONFIGENDDATE=@E_CONFIGDATE;
  SET UNITENDDATE=@INVOICE_DATE;
    IF(PROCESS = 'INSERT') OR (PROCESS='UPDATE')THEN  
		IF (NEWINVOICEDATE > CURDATE())THEN
    SET ERRORMSG=(SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=474);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERRORMSG;
		END IF;
		IF(NEWINVOICEDATE NOT BETWEEN UNITSTARTDATE AND UNITENDDATE)THEN
     SET ERRORMSG=(SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=475);
			SIGNAL SQLSTATE '45000'
			SET MESSAGE_TEXT= ERRORMSG;
		END IF;
        END IF;
END;