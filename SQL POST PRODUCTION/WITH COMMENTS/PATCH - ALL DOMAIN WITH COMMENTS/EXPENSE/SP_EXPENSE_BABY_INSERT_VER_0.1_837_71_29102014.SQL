-- version:0.1 --sdate:29-10-2014 --edate:29-10-2014 --issue:837 --commentno#71 --desc:PATCH TO INSERT VALUES IN EXPENSE_BABY TABLE  --doneby:RL

DROP PROCEDURE IF EXISTS SP_EXPENSE_BABY_INSERT;
CREATE PROCEDURE SP_EXPENSE_BABY_INSERT(IN FILENAME TEXT,
IN USERSTAMP VARCHAR(50),
OUT SUCCESS_MESSAGE TEXT)

BEGIN

-- VARIABLE DECLARE FOR SHOW SUCCESS MESSAGE
	DECLARE FAILURE_ECN_DATA TEXT;
	DECLARE FAIL_ECNDATA TEXT;
	DECLARE SUCCESS_ECNDATA TEXT;
	DECLARE FAILURE_ECNDATA TEXT;
	DECLARE SUCCESSECNDATA TEXT;
	DECLARE FAILUREECNDATA TEXT;
	DECLARE PATCHFILENAME VARCHAR(100);
	DECLARE PHSTATUS TINYINT;

	DECLARE MINID INTEGER;
	DECLARE MAXID INTEGER;
	DECLARE ECNDATA TEXT;
	DECLARE USTAMP VARCHAR(50);
	DECLARE INVOICEDATE TIMESTAMP;

	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK;
		DROP TABLE IF EXISTS TEMP_BABY_EXPENSE;
	END;

	SET AUTOCOMMIT = 0;
 	START TRANSACTION;

-- QUERY FOR GET ERROR MSG FROM ERROR_MESSAGE_CONFIGURATION TABLE
	SET SUCCESS_ECNDATA =  (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=469);
	SET FAILURE_ECNDATA =  (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=470);
	SET FAILURE_ECN_DATA = (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=473);
	SET SUCCESSECNDATA = (SELECT REPLACE(SUCCESS_ECNDATA,'[FILENAME]',FILENAME));
	SET FAILUREECNDATA = (SELECT REPLACE(FAILURE_ECNDATA,'[FILENAME]',FILENAME));
	SET FAIL_ECNDATA = (SELECT REPLACE(FAILURE_ECN_DATA,'[FILENAME]',FILENAME));

-- QUERY FOR SHOW ERROR MSG THE FILE IS ALDEARY EXISTS IN PATCH_HISTORY TABLE
	IF EXISTS(SELECT PH_FILE_NAME FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME AND PH_STATUS = 1) THEN
		SET SUCCESS_MESSAGE = FAILUREECNDATA;
	END IF;

	SET PATCHFILENAME = (SELECT PH_FILE_NAME FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME);
	SET PHSTATUS = (SELECT PH_STATUS FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME AND PH_STATUS = 0);

	IF ((PATCHFILENAME IS NOT NULL) AND (PHSTATUS = 0)) OR (PATCHFILENAME IS NULL)THEN

		DROP TABLE IF EXISTS TEMP_BABY_EXPENSE;
		CREATE TABLE TEMP_BABY_EXPENSE(
		ID INTEGER AUTO_INCREMENT PRIMARY KEY,
		PE_TYPE_OF_EXPENSE TEXT,
		PE_BABY_EXPENSE TEXT NOT NULL,
		PE_BABY_INVOICE_DATE DATE NOT NULL,
		PE_BABY_AMOUNT DECIMAL(7,2) NOT NULL,
		PE_BABY_INVOICE_ITEMS TEXT NOT NULL,
		PE_BABY_INVOICE_FROM VARCHAR(200) NOT NULL,
		PE_BABY_COMMENTS TEXT NULL,
		PE_BABY_TIMESTAMP TIMESTAMP NULL,
		PE_USERSTAMP VARCHAR(50) NOT NULL);
	
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (1,NULL,'HEALTH CARE/HOSPITAL EXPENSE','2014-06-16',139.64,'MEDICAL FEE','KINDER CLINIC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (2,NULL,'SCHOOL','2014-06-19',75.00,'HOLIDAY PROGRAMME','WEE CARE KINDERGARTEN',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (3,NULL,'SCHOOL','2014-06-20',75.00,'JUNE FRIDAY HOLIDAY PROGRAM','WEE CARE KINDERGARTEN',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (4,NULL,'MISCELLANEOUS','2014-06-26',15.00,'CD','TENSAI',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (5,NULL,'SCHOOL','2014-07-03',3172.00,'TERM 3 FEES','WEE CARE KINDERGARTEN',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (6,NULL,'MISCELLANEOUS','2014-07-08',3.90,'SOCKS','KAWATA HOUSE OF SOCKS',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (7,NULL,'SCHOOL','2014-07-12',293.53,'FRENCH CLASS','ALLIANCE FRANCAISE',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (8,NULL,'MISCELLANEOUS','2014-07-13',11.10,'NO DESC','COOL DE SAC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (9,'BABY','MISCELLANEOUS','2014-07-20',25.00,'FEE','THE POLLIWOGS',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (10,NULL,'MISCELLANEOUS','2014-05-01',38.73,'ENTRANCE FEE','AMAZONIA SINGAPORE',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (11,NULL,'MISCELLANEOUS','2014-06-01',24.14,'ENTRANCE FEE','AMAZONIA SINGAPORE',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (12,NULL,'MISCELLANEOUS','2014-05-15',31.53,'NORDIC NATURALS CHILDREN DHA','WELLGROWTH',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (13,NULL,'MISCELLANEOUS','2014-07-28',328.00,'SAMSUNG GALAXY KID','TOYS R US',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (14,NULL,'MISCELLANEOUS','2014-04-24',80.00,'FEE','MINICHAMPS READING & WRITING',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (15,NULL,'MISCELLANEOUS','2014-02-23',23.00,'PLAY GYM','ROYCE KIDS GYM',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (16,NULL,'MISCELLANEOUS','2014-02-23',27.00,'PLAY GYM','ROYCE KIDS GYM',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (17,NULL,'MISCELLANEOUS','2014-07-27',36.00,'FUNPLAY','ROYCE KIDS GYM',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (18,NULL,'HEALTH CARE/HOSPITAL EXPENSE','2014-07-30',194.74,'MEDICINE AND CONSULTATION FEE','KINDER CLINIC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (19,NULL,'MISCELLANEOUS','2014-07-30',29.90,'SHOES','ISETAN',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (20,NULL,'MISCELLANEOUS','2014-07-30',34.36,'CLOTHES','ISETAN',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (21,NULL,'HEALTH CARE/HOSPITAL EXPENSE','2014-08-22',25.00,'MEDICINE','KINDER CLINIC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (22,NULL,'HEALTH CARE/HOSPITAL EXPENSE','2014-08-20',199.56,'CONSULTATION AND MEDICINE','KINDER CLINIC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (23,NULL,'SCHOOL','2014-08-27',2878.52,'TERM 4, 2014 FEE, LANGUAGE BOOK','WEE CARE KINDERGARTEN','PAID NETS TRANSACTION 000223','2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (24,NULL,'SCHOOL','2014-08-27',553.00,'TERM 3 FEES CHINESE SPEECH AND DRAMA','WEE CARE KINDERGARTEN','PAID NETS TRANSACTION 000247','2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (25,NULL,'SCHOOL','2014-08-27',474.00,'TERM 4 CREATIVE MOVEMENT','WEE CARE KINDERGARTEN','PAID NETS TRANSACTION 000247','2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (26,NULL,'SCHOOL','2014-08-27',474.00,'TERM 4 CHINESE SPEECH & DRAMA','WEE CARE KINDERGARTEN','PAID NETS TRANSACTION 000247','2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (27,NULL,'MISCELLANEOUS','2014-08-23',38.00,'APPAREL','MUMMYKIDZ',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (28,NULL,'MISCELLANEOUS','2014-08-21',12.95,'DIAPERS','MUSTAFA',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (29,NULL,'MISCELLANEOUS','2014-08-24',13.95,'DIAPERS','JOHN LITTLE',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (30,NULL,'MISCELLANEOUS','2014-07-13',22.10,'ADMISSION','COOL DE SAC',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (31,NULL,'SCHOOL','2014-09-06',888.10,'TERM FEE AND ANNUAL REGISTRATION FEE','SHICHIDA',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (32,NULL,'MISCELLANEOUS','2014-08-31',11.90,'EDUCATIONAL TOY','MY GREATEST CHILD',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (33,NULL,'MISCELLANEOUS','2014-09-04',15.00,'NOTEBOOK','SMIGGLE',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (34,NULL,'MISCELLANEOUS','2014-08-30',12.50,'EDUCATIONAL TOY','MY GREATEST CHILD',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');
		INSERT INTO `TEMP_BABY_EXPENSE`(`ID`,`PE_TYPE_OF_EXPENSE`,`PE_BABY_EXPENSE`,`PE_BABY_INVOICE_DATE`,`PE_BABY_AMOUNT`,`PE_BABY_INVOICE_ITEMS`,`PE_BABY_INVOICE_FROM`,`PE_BABY_COMMENTS`,`PE_BABY_TIMESTAMP`,`PE_USERSTAMP`) VALUES (35,NULL,'MISCELLANEOUS','2014-09-10',50.00,'CLOTHES','BABY SHOP ASIA',NULL,'2014-10-29 14:03:37','VISWANATH.N@SSOMENS.COM');

		UPDATE `TEMP_BABY_EXPENSE` SET PE_BABY_EXPENSE = 'HEALTH CARE/HOSPITAL EXPENSES' WHERE PE_BABY_EXPENSE = 'HEALTH CARE/HOSPITAL EXPENSE';

		ALTER TABLE `TEMP_BABY_EXPENSE` ADD COLUMN ECN_ID INTEGER NOT NULL;
		ALTER TABLE `TEMP_BABY_EXPENSE` ADD COLUMN ULDID INTEGER NOT NULL;

		SET MINID = (SELECT MIN(ID) FROM `TEMP_BABY_EXPENSE`);
		SET MAXID = (SELECT MAX(ID) FROM `TEMP_BABY_EXPENSE`);

		WHILE(MINID <= MAXID)DO

			SET USTAMP = (SELECT PE_USERSTAMP FROM `TEMP_BABY_EXPENSE` WHERE ID = MINID);
			SET ECNDATA = (SELECT PE_BABY_EXPENSE FROM `TEMP_BABY_EXPENSE` WHERE ID = MINID);
			SET INVOICEDATE = (SELECT PE_BABY_INVOICE_DATE FROM `TEMP_BABY_EXPENSE` WHERE ID = MINID);

			UPDATE `TEMP_BABY_EXPENSE` SET ECN_ID = (SELECT ECN_ID FROM EXPENSE_CONFIGURATION WHERE ECN_DATA = ECNDATA AND CGN_ID = 25),
			ULDID = (SELECT ULD_ID FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID = USTAMP),
			PE_BABY_TIMESTAMP = INVOICEDATE WHERE ID = MINID;

		SET MINID = MINID+1;
		END WHILE;

		INSERT INTO EXPENSE_BABY(ECN_ID,EB_INVOICE_DATE,EB_AMOUNT,EB_INVOICE_ITEMS,EB_INVOICE_FROM,EB_COMMENTS,ULD_ID,EB_TIMESTAMP)
		SELECT ECN_ID,PE_BABY_INVOICE_DATE,PE_BABY_AMOUNT,PE_BABY_INVOICE_ITEMS,PE_BABY_INVOICE_FROM,PE_BABY_COMMENTS,ULDID,PE_BABY_TIMESTAMP FROM TEMP_BABY_EXPENSE;

		INSERT INTO PATCH_HISTORY(PO_ID,PH_FILE_NAME,PH_STATUS,ULD_ID) VALUES (8,FILENAME,1,(SELECT ULD_ID FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP));
		SET SUCCESS_MESSAGE = SUCCESSECNDATA;
	
	END IF;

	DROP TABLE IF EXISTS `TEMP_BABY_EXPENSE`;

	COMMIT;

END;

CALL SP_EXPENSE_BABY_INSERT(FILENAME,USERSTAMP,@SUCCESS_MESSAGE);