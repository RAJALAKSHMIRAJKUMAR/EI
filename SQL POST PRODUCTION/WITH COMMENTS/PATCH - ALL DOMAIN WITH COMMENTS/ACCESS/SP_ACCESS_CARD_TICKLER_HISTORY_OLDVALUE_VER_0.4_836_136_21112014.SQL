-- version:0.4 --sdate:21/11/2014 --edate:21/11/2014 --issue:836 --comment no#136 --desc:CHANGED FILE NAME --done by:DHIVYA
-- version:0.3 --sdate:22/08/2014 --edate:22/08/2014 --issue:831 --comment no#141 --desc:REMOVING timestamp in old value n changed the old values order n added 1 output parameter --done by:RL
-- VER:0.2 --SDATE:08/08/2014 --EDATE:08/08/2014 --ISSUE:831 --DESC:removing extra commas --DONEBY:Bhavani.R
-- VER:0.1 --SDATE:24/07/2014 --EDATE:25/07/2014 --ISSUE:831 --DESC:UPDATE THE TICKLER HISTORY FOR ACCESS_CARD_DETAILS --DONEBY:THIRUPATHI.P
DROP PROCEDURE IF EXISTS SP_ACCESS_CARD_TICKLER_HISTORY_OLDVALUE;
CREATE PROCEDURE SP_ACCESS_CARD_TICKLER_HISTORY_OLDVALUE (
IN CUSTOMERID INTEGER,
IN CACDID INTEGER,
IN USERSTAMP VARCHAR(50),
OUT OLDVALUE_ACCESS TEXT,
OUT OLDUASDID INTEGER)
BEGIN
	DECLARE NEWULDID INTEGER;
	SET OLDVALUE_ACCESS='';
	SET NEWULDID = (SELECT ULD_ID FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP);
	SET OLDUASDID = (SELECT UASD_ID FROM CUSTOMER_ACCESS_CARD_DETAILS WHERE CUSTOMER_ID = CUSTOMERID AND CACD_ID = CACDID);
	SET OLDVALUE_ACCESS = (SELECT CONCAT (OLDVALUE_ACCESS,'CACD_ID = ',CACDID,',CUSTOMER_ID=',CUSTOMERID,',UASD_ID=',OLDUASDID));
	SET OLDVALUE_ACCESS = (SELECT CONCAT (OLDVALUE_ACCESS));
END;
