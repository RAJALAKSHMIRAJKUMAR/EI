-- version:0.3 --sdate:22/08/2014 --edate:22/08/2014 --issue:831 --comment no#141 --desc:REMOVING timestamp in old value n changed the old values order n added 1 output parameter --done by:RL
-- version:0.2 --sdate:08/08/2014 --edate:08/08/2014 --issue:831 --desc:REMOVING EXTRA COMMAS --done by:Bhavani.R
-- version:0.1 --sdate:24/07/2014 --edate:25/07/2014 --issue:831 --desc:TICKLER PART FOR CUSTOMER DOMAIN UPDATE PATCH --done by:Bhavani.R
DROP PROCEDURE IF EXISTS SP_CUSTOMER_LP_TICKLER_OLDVALUE;
CREATE PROCEDURE SP_CUSTOMER_LP_TICKLER_OLDVALUE (
IN CUSTOMERID INTEGER,
IN CLPID INTEGER,
IN CPDID INTEGER,
IN USERSTAMP VARCHAR(50),
OUT OLDVALUE_LP TEXT,
OUT OLDVALUE_PERSONAL TEXT,
OUT OLDUASDID INTEGER,
OUT OLDCOMMENTS TEXT)
BEGIN
-- DECLARING VARIABLES
	DECLARE NEWULDID INTEGER;
	DECLARE RECVER INTEGER;
--  QUERY FOR ROLLBACK COMMAND
	SET OLDVALUE_LP='';
	SET OLDVALUE_PERSONAL='';
	SET NEWULDID = (SELECT ULD_ID FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP);
	SET RECVER = (SELECT CED_REC_VER FROM CUSTOMER_LP_DETAILS WHERE CUSTOMER_ID = CUSTOMERID AND CLP_ID = CLPID);
	SET OLDUASDID = (SELECT UASD_ID FROM CUSTOMER_LP_DETAILS WHERE CUSTOMER_ID = CUSTOMERID AND CLP_ID = CLPID);
	SET OLDVALUE_LP =(SELECT CONCAT (OLDVALUE_LP,'CLP_ID = ',CLPID,',CUSTOMER_ID=',CUSTOMERID,',CED_REC_VER=',RECVER,',UASD_ID=',OLDUASDID));
	SET OLDVALUE_LP = (SELECT CONCAT (OLDVALUE_LP));
	SET OLDCOMMENTS = (SELECT CPD_COMMENTS FROM CUSTOMER_PERSONAL_DETAILS WHERE CPD_ID = CPDID AND CUSTOMER_ID = CUSTOMERID);
	SET OLDVALUE_PERSONAL = (SELECT CONCAT(OLDVALUE_PERSONAL,'CPD_ID = ',CPDID,',CUSTOMER_ID = ',CUSTOMERID,',CPD_COMMENTS = ',OLDCOMMENTS));
END;
