-- VERSION:0.3 --DATE:11/05/2015 --DESC:CUSTOMER UPDATE SUB SP ADDED (212 TO 217) --DONE BY:RL
-- version:0.2 --sdate:26/12/2014 --edate:26/12/2014 --issue:837 --commentno#151 --desc:ADDED INSERT QUERY FOR SP_DROP_DYNAMIC_TEMP_TABLE IN SPP_ID --done by:RL
-- version:0.1 --sdate:13/11/2014 --edate:13/11/2014 --issue:837 --commentno#85 --desc:PATCH TO DROP VIEW_PROFILE TABLE, N TRUNCATE & INSERT VALUES IN STORED_PROCEDURE_PROFILE TABLE --done by:RL

DROP PROCEDURE IF EXISTS SP_STORED_PROCEDURE_PROFILE_INSERT_116_T0_217;
CREATE PROCEDURE SP_STORED_PROCEDURE_PROFILE_INSERT_116_T0_217(
IN FILENAME TEXT,
IN USERSTAMP VARCHAR(50),
OUT SUCCESS_MESSAGE TEXT)
BEGIN

-- VARIABLE DECLARATION
    DECLARE FAILURE_ECN_DATA TEXT;
	DECLARE FAIL_ECNDATA TEXT;
    DECLARE SUCCESS_ECNDATA TEXT;
	DECLARE FAILURE_ECNDATA TEXT;
	DECLARE SUCCESSECNDATA TEXT;
	DECLARE FAILUREECNDATA TEXT;
	DECLARE PATCHFILENAME VARCHAR(100);
	DECLARE PHSTATUS TINYINT;
	
-- QUERY FOR ROLLBACK COMMAND
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN 
		ROLLBACK;
		INSERT INTO PATCH_HISTORY(PO_ID,PH_FILE_NAME,PH_STATUS,ULD_ID) VALUES (2,FILENAME,0,(SELECT ULD_ID 
		FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP));
		SET SUCCESS_MESSAGE = FAIL_ECNDATA;
	END;
	START TRANSACTION;
	
-- QUERY FOR GET ERROR MESSGAE FROM ERROR_MESSAGE_CONFIGURATION TABLE
	SET SUCCESS_ECNDATA =  (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=469);
	SET FAILURE_ECNDATA =  (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=470);
	SET FAILURE_ECN_DATA = (SELECT EMC_DATA FROM ERROR_MESSAGE_CONFIGURATION WHERE EMC_ID=473);
	
-- QUERY FOR REPLACE [FILENAME]
	SET SUCCESSECNDATA = (SELECT REPLACE(SUCCESS_ECNDATA,'[FILENAME]',FILENAME));
	SET FAILUREECNDATA = (SELECT REPLACE(FAILURE_ECNDATA,'[FILENAME]',FILENAME));
	SET FAIL_ECNDATA = (SELECT REPLACE(FAILURE_ECN_DATA,'[FILENAME]',FILENAME));
	
-- QUERY FOR CHECK THE PASSING FILE NAME EXISTS IN PATCH_HISTORY TABLE
	IF EXISTS(SELECT PH_FILE_NAME FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME AND PH_STATUS = 1) THEN
		SET SUCCESS_MESSAGE = FAILUREECNDATA;
	END IF;
	
-- QUERY FOR CHECK THE PASSING FILE NAME NOT EXISTS IN PATCH_HISTORY TABLE
	SET PATCHFILENAME = (SELECT PH_FILE_NAME FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME);
	SET PHSTATUS = (SELECT PH_STATUS FROM PATCH_HISTORY WHERE PH_FILE_NAME = FILENAME AND PH_STATUS = 0);
	
	IF ((PATCHFILENAME IS NOT NULL) AND (PHSTATUS = 0)) OR (PATCHFILENAME IS NULL)THEN
    
        INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('116','SP_CHARTS_BIZ_EXPENSE_ALLUNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('117','SP_CHARTS_GET_UNIT_RENTAL_ALLUNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('118','SP_CHARTS_SINGLE_EXPENSE_ALL_UNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('119','SP_CHARTS_GROSS_REVENUE_PERUNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('120','SP_CHARTS_SINGLE_PERSONAL_EXPENSE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('121','SP_CHARTS_GROSS_REVENUE_ALLUNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('122','SP_CHARTS_BIZ_EXPENSE_PERUNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('123','SP_CHARTS_PERSONAL_EXPENSE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('124','SP_CHARTS_BIZ_EXPENSE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('125','SP_OUTSTANDING_PAYMENTLIST');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('126','SP_OCBC_PAYMENT_DETAIL_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('127','SP_PAYMENT_DETAIL_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('128','SP_PAYMENT_DETAIL_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('129','SP_PAYMENT_SEARCH_TEMP_TABLE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('130','SP_PAYMENT_ENTRY_TERMINATED_CUSTOMER');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('131','SP_DD_PDP_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('132','SP_DD_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('133','SP_DD_UNIT_EXPENSE_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('134','SP_DD_GET_UNIT_CUSTNAME');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('135','SP_DD_ELECTRICITY_EXCESS_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('136','SP_DD_FLD_CARD_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('137','SP_DD_NO_OF_DIVISION_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('138','SP_CHEQUE_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('139','SP_CHEQUE_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('140','SP_EMAIL_TEMPLATE_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('141','SP_ERM_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('142','SP_ERM_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('143','SP_REPORT_CURRENT_ACTIVE_CUSTOMER');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('144','SP_CONFIG_CHECK_TRANSACTION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('145','SP_BANK_TT_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('146','SP_BANK_TT_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('147','SP_TEMP_BANK_TT_DATEANDAMOUNTRANGE_SERACH');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('148','SP_TEMP_TABLE_BANKTT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('149','SP_CHANGE_USERSTAMP_AS_ULDID');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('150','SP_CHK_TRANSACTION_AND_DELETION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('151','SP_CHK_TRANSACTION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('152','SP_GET_SPECIAL_CHARACTER_SEPERATED_VALUES');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('153','SP_SINGLE_TABLE_ROW_DELETION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('154','SP_DROP_PROD_TEMP_TABLE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('155','SP_CUSTOMER_LP_DETAILS_ULD_TS_MAXTIMES');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('156','SP_CUSTOMER_MANUAL_TERMINATION_PTDSYSDATE_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('157','SP_TRG_CUSTOMER_ACCESS_CARD_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('158','SP_TRG_CUSTOMER_COMPANY_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('159','SP_TRG_CUSTOMER_ENTRY_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('160','SP_TRG_CUSTOMER_FEE_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('161','SP_TRG_CUSTOMER_LP_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('162','SP_TRG_CUSTOMER_PERSONAL_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('163','SP_CUSTOMER_EMPLOYEE_CARD_DELETION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('164','SP_CUSTOMER_ROW_DELETION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('165','SP_CUSTOMER_TICKLER_ACCESS_CARD_DETAILS');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('166','SP_CUSTOMER_TICKLER_COMPANY_DETAILS');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('167','SP_CUSTOMER_TICKLER_EXPENSE_UNIT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('168','SP_CUSTOMER_TICKLER_LP_DETAILS');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('169','SP_CUSTOMER_TICKLER_PERSONAL_DETAILS');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('170','SP_CONFIG_SDATE_EDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('171','SP_EMPLOYEE_DETAILS_ULD_TS_MAXTIMES');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('172','SP_TRG_BIZDLY_AIRCON_SERVICE_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('173','SP_TRG_BIZDLY_CARPARK_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('174','SP_TRG_BIZDLY_EXPENSE_DIGITAL_VOICE_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('175','SP_TRG_BIZDLY_EXPENSE_ELECTRICITY_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('176','SP_TRG_BIZDLY_EXPENSE_STARHUB_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('177','SP_TRG_BIZDLY_EXPUNIT_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('178','SP_TRG_BIZDLY_FACILITY_USE_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('179','SP_TRG_BIZDLY_HOUSEKEEPING_PAYMENT_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('180','SP_TRG_BIZDLY_HOUSEKEEPING_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('181','SP_TRG_BIZDLY_MOVING_IN_AND_OUT_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('182','SP_TRG_BIZDLY_PETTYCASH_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('183','SP_TRG_BIZDLY_PURCHASE_NEW_CARD_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('184','SP_TRG_BIZDTL_DIGITAL_VOICE_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('185','SP_TRG_BIZDTL_ELECTRICITY_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('186','SP_TRG_BIZDTL_STARHUB_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('187','SP_TRG_PERSONAL_BABY_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('188','SP_TRG_PERSONAL_CAR_LOAN_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('189','SP_TRG_PERSONAL_CAR_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('190','SP_TRG_PERSONAL_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('191','SP_TRG_STAFFDLY_AGENT_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('192','SP_TRG_STAFFDLY_SALARY_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('193','SP_TRG_STAFFDLY_STAFF_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('194','SP_BIZ_DETAIL_STARHUB_DELETION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('195','SP_BIZDLY_ELECTRICITY_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('196','SP_BIZDLY_STARHUB_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('197','SP_STAFFDLY_STAFF_SALARY_INSERT');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('198','SP_STAFFDLY_STAFF_SALARY_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('199','SP_TRG_EMPLOYEE_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('200','SP_TRG_STAFFDTL_SALARY_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('201','SP_TRG_UNIT_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('202','SP_TRG_UNIT_LOGIN_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('203','SP_UNIT_CHECK_TRANSACTION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('204','SP_UNIT_DETAILS_ULD_TS_MAXTIMES');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('205','SP_TRG_CHEQUE_ENTRY_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('206','SP_TRG_ERM_ENTRY_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('207','SP_TRG_OCBC_BANK_RECORDS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('208','SP_DROP_TEMP_TABLE_DD_NO_OF_DIVISION_CALCULATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('209','SP_TRG_PAYMENT_DETAILS_VALIDATION');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('210','SP_OUTSTANDING_PAYMENTLIST_TEMPTABLE_DROP');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES
		('211','SP_DROP_DYNAMIC_TEMP_TABLE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('212','SP_CUSTOMER_SEARCH_CUSTOMER_TABLE_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('213','SP_CUSTOMER_SEARCH_COMPANY_DTLS_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('214','SP_CUSTOMER_SEARCH_ENTRY_DTLS_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('215','SP_CUSTOMER_SEARCH_FEE_DTLS_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('216','SP_CUSTOMER_SEARCH_ACCESS_TERMINATION_DTLS_UPDATE');
		INSERT INTO STORED_PROCEDURE_PROFILE(SPP_ID,SPP_NAME) VALUES('217','SP_CUSTOMER_SEARCH_PERSONAL_DTLS_UPDATE');
        
-- QUERY FOR INSERT VALUES IN PATCH_HISTORY
    	INSERT INTO PATCH_HISTORY(PO_ID,PH_FILE_NAME,PH_STATUS,ULD_ID) VALUES (2,FILENAME,1,(SELECT ULD_ID 
        FROM USER_LOGIN_DETAILS WHERE ULD_LOGINID=USERSTAMP));
		SET SUCCESS_MESSAGE = SUCCESSECNDATA;
		
	END IF;
	
	COMMIT;
END;

CALL SP_STORED_PROCEDURE_PROFILE_INSERT_116_T0_217(FILENAME,USERSTAMP,@SUCCESS_MESSAGE);